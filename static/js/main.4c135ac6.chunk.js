(this.webpackJsonptaba=this.webpackJsonptaba||[]).push([[0],{116:function(t,e){},160:function(t,e,o){t.exports=o(176)},165:function(t,e){},175:function(t,e,o){},176:function(t,e,o){"use strict";o.r(e);var n,i=o(34),r=o.n(i),a=o(133),s=o.n(a),c=o(93),l=o.n(c),u=o(69),g=o(145),p=o(197),d=o(199),h=o(124),f=o(130),m=o(106),v=o(45),y=o(141),L=o(191),w=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),C=function(){return(C=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},O=[0,132,193,255],b=function(t){function e(e){return t.call(this,e)||this}return w(e,t),e.prototype.getShaders=function(){return t.prototype.getShaders.call(this,{vs:"#define SHADER_NAME animated-flow-lines-layer-vertex-shader\n#define SPEED 0.015\n#define NUM_PARTS 5.0\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instancePickable;\nattribute float instanceStaggering;\n\nuniform float opacity;\nuniform float currentTime;\nuniform float thicknessUnit;\n    \nvarying vec4 vColor;\nvarying float sourceToTarget;\nvarying vec2 uv;\n\n// offset vector by strokeWidth pixels\n// offset_direction is -1 (left) or 1 (right)\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  return dir_screenspace * offset_direction * width / 2.0;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n\n  // Position\n  vec4 source_commonspace;\n  vec4 target_commonspace;\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);\n\n  float widthPixels = instanceWidths * thicknessUnit;\n  \n  \n  // linear interpolation of source & target to pick right coord\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);\n  uv = positions.xy;\n  geometry.uv = uv;\n  if (instancePickable > 0.5) {\n    geometry.pickingColor = instancePickingColors;\n  }\n  \n  // extrude\n  vec3 offset = vec3(\n    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),\n    0.0);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  // Color\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  sourceToTarget = positions.x * length(source - target) * NUM_PARTS - currentTime * SPEED + instanceStaggering; \n}\n",fs:"#define SHADER_NAME animated-flow-lines-layer-fragment-shader\n\nprecision highp float;\n\nuniform float tailLength;\n\nvarying vec4 vColor;\nvarying float sourceToTarget;\nvarying vec2 uv;\n                                   \nvoid main(void) {\n  geometry.uv = uv;\n\n  gl_FragColor = vec4(vColor.xyz, vColor.w * smoothstep(1.0 - tailLength, 1.0, fract(sourceToTarget)));\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.a,f.a],shaderCache:this.context.shaderCache})},e.prototype.initializeState=function(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,transition:!0,accessor:"getTargetPosition"},instanceColors:{size:4,type:v.UNSIGNED_BYTE,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getThickness",defaultValue:1},instanceStaggering:{accessor:"getStaggering",size:1,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})},e.prototype.updateState=function(e){var o=e.props,n=e.oldProps,i=e.changeFlags;if(t.prototype.updateState.call(this,{props:o,oldProps:n,changeFlags:i}),i.extensionsChanged){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}},e.prototype.draw=function(t){var e=t.uniforms,o=this.props,n=o.currentTime,i=o.thicknessUnit,r=o.tailLength;this.state.model.setUniforms(C(C({},e),{thicknessUnit:4*i,tailLength:r,currentTime:n})).draw()},e.prototype._getModel=function(t){return new y.a(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new L.a({drawMode:v.TRIANGLE_STRIP,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0}))},e.defaultProps={currentTime:0,tailLength:.7,getSourcePosition:{type:"accessor",value:function(t){return t.sourcePosition}},getTargetPosition:{type:"accessor",value:function(t){return t.targetPosition}},getPickable:{type:"accessor",value:function(t){return 1}},getStaggering:{type:"accessor",value:function(t,e){e.index;return Math.random()}},getColor:{type:"accessor",value:O},getThickness:{type:"accessor",value:1},thicknessUnit:30,parameters:{depthTest:!1}},e}(m.a),I=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),T=[0,0,0,255],_=function(t){function e(e){return t.call(this,e)||this}return I(e,t),e.prototype.getShaders=function(){return t.prototype.getShaders.call(this,{vs:"#define SHADER_NAME flow-circles-layer-vertex-shader\n#define radiusScale 100\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  outerRadiusPixels = instanceRadius;  \n\n  // position on the containing square in [-1, 1] space\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n                                                                                                    \n  // Find the center of the point and add the current vertex\n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  DECKGL_FILTER_SIZE(offset, geometry);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n                            \n  // Apply opacity to instance color, or return instance picking color\n  vColor = vec4(instanceColors.rgb / 255., instanceColors.a / 255. * opacity);\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME flow-circles-layer-fragment-shader\n#define SOFT_OUTLINE 0.1\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n  float distToCenter = length(unitPosition);\n  if (distToCenter > 1.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n  gl_FragColor.a *= smoothstep(0.0, SOFT_OUTLINE, 1.0 - distToCenter);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.a,f.a]})},e.prototype.initializeState=function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:v.DOUBLE,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceColors:{size:4,transition:!0,type:v.UNSIGNED_BYTE,accessor:"getColor",defaultValue:T}})},e.prototype.updateState=function(e){var o=e.props,n=e.oldProps,i=e.changeFlags;if(t.prototype.updateState.call(this,{props:o,oldProps:n,changeFlags:i}),i.extensionsChanged){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}},e.prototype.draw=function(t){var e=t.uniforms;this.state.model.setUniforms(e).draw()},e.prototype._getModel=function(t){return new y.a(t,Object.assign(this.getShaders(),{id:this.props.id,geometry:new L.a({drawMode:v.TRIANGLE_FAN,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}}),isInstanced:!0}))},e.layerName="FlowCirclesLayer",e.defaultProps={getColor:{type:"accessor",value:T},getPosition:{type:"accessor",value:function(t){return t.position}},getRadius:{type:"accessor",value:1},parameters:{depthTest:!1}},e}(m.a),S=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),F=function(){return(F=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},A=[0,132,193,255],P=function(t){function e(e){return t.call(this,e)||this}return S(e,t),e.prototype.getShaders=function(){return t.prototype.getShaders.call(this,{vs:"#define SHADER_NAME flow-line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 instanceColors;\nattribute float instanceThickness;    // 0..0.5\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec3 instanceSourcePositions64Low;\nattribute vec3 instanceTargetPositions64Low;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceEndpointOffsets;\nattribute float instancePickable;\n\nuniform vec4 outlineColor;\nuniform float thicknessUnit;\nuniform float gap;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.worldPosition = instanceSourcePositions;\n  geometry.worldPositionAlt = instanceTargetPositions;\n  \n  // Position\n  vec4 source_commonspace;    \n  vec4 target_commonspace;\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);\n\n  // linear interpolation of source & target to pick right coord\n  float sourceOrTarget = positions.x;\n  geometry.position = mix(source_commonspace, target_commonspace, sourceOrTarget);\n  uv = positions.xy;\n  geometry.uv = uv;\n  if (instancePickable > 0.5) {\n    geometry.pickingColor = instancePickingColors;\n  }\n  \n  // set the clamp limits in pixel size \n  float lengthCommon = length(target_commonspace - source_commonspace);    \n  vec2 offsetDistances = project_pixel_size(positions.yz) * thicknessUnit;\n  \n  vec2 limitedOffsetDistances = clamp(   \n    project_pixel_size(positions.yz) * thicknessUnit,\n    -lengthCommon*.8, lengthCommon*.8\n  );\n  float startOffsetCommon = project_pixel_size(instanceEndpointOffsets[0]);\n  float endOffsetCommon = project_pixel_size(instanceEndpointOffsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    positions.x\n  );\n\n  vec2 flowlineDir = normalize(target_commonspace.xy - source_commonspace.xy);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\n  vec2 normalsCommon = project_pixel_size(normals.xy);\n  float gapCommon = project_pixel_size(gap);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (instanceThickness * limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir * (instanceThickness * limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n  \n  DECKGL_FILTER_SIZE(offsetCommon, geometry);\n  vec4 position_commonspace = mix(source_commonspace, target_commonspace, sourceOrTarget);\n  vec4 offset_commonspace = vec4(offsetCommon, 0.0);\n  gl_Position = project_common_position_to_clipspace(position_commonspace + offset_commonspace);\n      \n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  \n  vec4 fillColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  if (instancePickable <= 0.5) {\n    vColor = mix(fillColor, vec4(outlineColor.xyz, instanceThickness), normals.z);\n  } else {\n    vColor = mix(fillColor, vec4(outlineColor.xyz, outlineColor.w * fillColor.w), normals.z);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME flow-line-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 uv;\n\nvoid main(void) {\n  if (vColor.a == 0.0) {\n    discard;\n  }\n\n  geometry.uv = uv;\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.a,f.a],shaderCache:this.context.shaderCache})},e.prototype.initializeState=function(){this.state.attributeManager.addInstanced({instanceSourcePositions:{accessor:"getSourcePosition",size:3,transition:!1,type:v.DOUBLE},instanceTargetPositions:{accessor:"getTargetPosition",size:3,transition:!1,type:v.DOUBLE},instanceThickness:{accessor:"getThickness",size:1,transition:!1},instanceEndpointOffsets:{accessor:"getEndpointOffsets",size:2,transition:!1},instanceColors:{accessor:"getColor",size:4,type:v.UNSIGNED_BYTE,transition:!1},instancePickable:{accessor:"getPickable",size:1,transition:!1}})},e.prototype.updateState=function(e){var o=e.props,n=e.oldProps,i=e.changeFlags;if(t.prototype.updateState.call(this,{props:o,oldProps:n,changeFlags:i}),i.extensionsChanged){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}},e.prototype.draw=function(t){var e=t.uniforms,o=this.context.gl,n=this.props,i=n.outlineColor,r=n.thicknessUnit;o.lineWidth(1),this.state.model.setUniforms(F(F({},e),{outlineColor:i.map((function(t){return t/255})),thicknessUnit:2*r,gap:.5})).draw()},e.prototype._getModel=function(t){var e=[],o=[],n=this.props,i=n.drawOutline,r=n.outlineThickness;if(i){e=e.concat([0,0,0,0,1,0,1,0,0,0,1,0,1,0,-3,1,1,-3,1,0,0,1,2,-3,1,0,-3]);var a=r;o=o.concat([-1,-a,1,a,-a,1,-1,a,1,a,-a,1,-1,0,1,a,0,1,-1,3*a,1,2*a,-a,1,-1,-a,1])}return e=e.concat([0,0,0,0,1,0,1,0,0,0,1,0,1,0,-3,1,1,-3,1,0,0,1,2,-3,1,0,-3]),o=o.concat([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),new y.a(t,F(F({id:this.props.id},this.getShaders()),{geometry:new L.a({drawType:v.TRIANGLES,attributes:{positions:new Float32Array(e),normals:new Float32Array(o)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))},e.layerName="FlowLinesLayer",e.defaultProps={getSourcePosition:{type:"accessor",value:function(t){return t.sourcePosition}},getTargetPosition:{type:"accessor",value:function(t){return t.targetPosition}},getColor:{type:"accessor",value:A},getThickness:{type:"accessor",value:function(t){return t.thickness}},getPickable:{type:"accessor",value:function(t){return 1}},drawOutline:!0,thicknessUnit:10,outlineThickness:1,outlineColor:[255,255,255,255],parameters:{depthTest:!1}},e}(m.a),E=o(195),x=o(196),k=o(105),M=o(143),j=o(77),D=o(136),G=o(33),N=o(207),R=o(82),z=o(118),H=o(205),U=function(){return(U=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},W=["rgba(240,240,240,0.5)","#137CBD"],B=["rgba(240,240,240,0.5)","#f6654e"],V=["rgba(240,240,240,0.5)","#00a9cc"],K=[255,255,255,255];function Z(t){return void 0!==t.positive}function J(t){var e=!(!t||!t.darkMode);return{darkMode:e,locationAreas:X(t&&t.locationAreas,e),outlineColor:Q(t&&t.outlineColor||"#fff"),dimmedOpacity:t&&null!=t.dimmedOpacity?t.dimmedOpacity:.4}}function Y(t){var e=J(t);return U(U({},e),$(t,W,e.darkMode))}function q(t){var e=J(t);return U(U({},e),{positive:$(t&&t.positive,B,e.darkMode),negative:$(t&&t.negative,V,e.darkMode)})}function X(t,e){var o=t&&t.normal||"rgba(220,220,220,0.5)",n=Object(N.a)(o),i=Q(o);return{normal:i,connected:tt(t&&t.connected,i),highlighted:tt(t&&t.highlighted,ot(n[e?"brighter":"darker"](1).toString(),.5)),selected:tt(t&&t.selected,ot(n[e?"brighter":"darker"](2).toString(),.8)),outline:tt(t&&t.outline,Q(n[e?"brighter":"darker"](4).toString()))}}function $(t,e,o){var n=t&&t.flows&&t.flows.scheme||e,i=Object(N.a)(n[n.length-1]),r=tt(t&&t.flows&&t.flows.highlighted,Q(i[o?"brighter":"darker"](.7).toString()));return{flows:{scheme:n,highlighted:r},locationCircles:{inner:tt(t&&t.locationCircles&&t.locationCircles.inner,i.toString()),outgoing:tt(t&&t.locationCircles&&t.locationCircles.outgoing,o?"#000":"#fff"),incoming:tt(t&&t.locationCircles&&t.locationCircles.incoming,i[o?"brighter":"darker"](1.25).toString()),highlighted:tt(t&&t.locationCircles&&t.locationCircles.highlighted,r)}}}function Q(t){var e=Object(R.c)(t);if(!e)return console.warn("Invalid color: ",t),K;var o=e.rgb();return[Math.floor(o.r),Math.floor(o.g),Math.floor(o.b),nt(e.opacity)]}function tt(t,e){return t?Q(t):"string"===typeof e?Q(e):e}function et(t){return"rgba("+t.join(",")+")"}function ot(t,e){var o=Object(R.c)(t);if(!o)return console.warn("Invalid color: ",t),"rgba(255, 255, 255, "+e+")";var n=o.rgb();return"rgba("+n.r+", "+n.g+", "+n.b+", "+e+")"}function nt(t){return Math.round(255*t)}function it(t,e){var o=Object(N.a)(et(t));if(!o)return console.warn("Invalid color: ",t),K;o.c*=.1;var n=o.rgb();return[Math.floor(n.r),Math.floor(n.g),Math.floor(n.b),nt(void 0!==e?e:.4)]}function rt(t,e,o){var n=Object(H.a)(Object(z.b)(e)).exponent(o?.5:1/3).domain(t);return function(t){return Q(n(t))}}function at(t){return"FeatureCollection"===t.type}!function(t){t.LOCATION="location",t.FLOW="flow",t.LOCATION_AREA="location-area"}(n||(n={}));var st,ct=function(t){return t.diffMode},lt=function(t){return t.colors},ut=function(t){return t.animate},gt=function(t){return at(t.locations)?t.locations.features:t.locations},pt=function(t){return t.flows},dt=function(t){return t.highlightedFlow},ht=function(t){return t.highlightedLocationId},ft=function(t){return t.selectedLocationIds},mt=function(t){return t.showOnlyTopFlows},vt=function(t){return null!=t.maxLocationCircleSize?t.maxLocationCircleSize:bt.defaultProps.maxLocationCircleSize},yt=function(){function t(t){var e=this;this.inputAccessors=t,this.getColors=Object(G.a)([lt,ct],(function(t,e){return e?q(t):Y(t)})),this.getLocationByIdGetter=Object(G.a)([gt],(function(t){var o=Object(M.a)().key(e.inputAccessors.getLocationId).rollup((function(t){return t[0]})).object(t);return function(t){var e=o[t];return e||console.warn("No location found for id '"+t+"'"),e}})),this.getFilteredFlows=Object(G.a)([pt,ft],(function(t,o){var n=e.inputAccessors,i=n.getFlowOriginId,r=n.getFlowDestId;return o?t.filter((function(t){return o.indexOf(i(t))>=0||o.indexOf(r(t))>=0})):t})),this.getNonSelfFlows=Object(G.a)([this.getFilteredFlows],(function(t){var o=e.inputAccessors,n=o.getFlowOriginId,i=o.getFlowDestId;return t.filter((function(t){return n(t)!==i(t)}))})),this.getSortedNonSelfFlows=Object(G.a)([this.getNonSelfFlows],(function(t){return t.slice().sort((function(t,o){return Math.abs(e.inputAccessors.getFlowMagnitude(t))-Math.abs(e.inputAccessors.getFlowMagnitude(o))}))})),this.getTopFlows=Object(G.a)([this.getSortedNonSelfFlows,mt],(function(t,e){return null!=e&&e>0&&t.length>e?t.slice(t.length-e,t.length):t})),this.getHighlightedFlows=Object(G.a)([this.getSortedNonSelfFlows,dt,ht],(function(t,o,n){var i=e.inputAccessors,r=i.getFlowOriginId,a=i.getFlowDestId;return o?[o]:n?t.filter((function(t){return r(t)===n||a(t)===n})):void 0})),this.getFlowMagnitudeExtent=Object(G.a)([this.getNonSelfFlows],(function(t){return Object(E.a)(t,(function(t){return e.inputAccessors.getFlowMagnitude(t)}))})),this.getFlowThicknessScale=Object(G.a)([this.getFlowMagnitudeExtent],(function(t){var e=t[0],o=t[1],n=Object(j.a)().range([.05,.5]).domain([0,Math.max(Math.abs(e||0),Math.abs(o||0))]);return function(t){return n(Math.abs(t))}})),this.getFlowColorScale=Object(G.a)([this.getColors,this.getFlowMagnitudeExtent,ut],(function(t,e,o){var n=e[0],i=e[1];if(Z(t)){var r=rt([0,i||0],t.positive.flows.scheme,o),a=rt([0,n||0],t.negative.flows.scheme,o);return function(t){return t>=0?r(t):a(t)}}var s=rt([0,i||0],t.flows.scheme,o);return function(t){return s(t)}})),this.getLocationTotals=Object(G.a)([gt,this.getFilteredFlows],(function(t,o){var n=e.inputAccessors,i=n.getFlowOriginId,r=n.getFlowDestId,a=n.getFlowMagnitude;return o.reduce((function(t,e){var o=i(e),n=r(e),s=a(e);return o===n?t.within[o]=(t.within[o]||0)+s:(t.outgoing[o]=(t.outgoing[o]||0)+s,t.incoming[n]=(t.incoming[n]||0)+s),t}),{incoming:{},outgoing:{},within:{}})})),this.getHighlightedLocationCircles=Object(G.a)([this.getLocationByIdGetter,ht],(function(t,e){if(e){var o=t(e);if(!o)return;return[{location:o,type:"outline"},{location:o,type:"outer"},{location:o,type:"inner"}]}})),this.getLocationTotalInGetter=function(t){var o=e.inputAccessors,n=o.getLocationTotalIn,i=o.getLocationId;if(n)return n;var r=e.getLocationTotals(t).incoming;return function(t){return r[i(t)]||0}},this.getLocationTotalOutGetter=function(t){var o=e.inputAccessors,n=o.getLocationTotalOut,i=o.getLocationId;if(n)return n;var r=e.getLocationTotals(t).outgoing;return function(t){return r[i(t)]||0}},this.getLocationTotalWithinGetter=function(t){var o=e.inputAccessors,n=o.getLocationTotalWithin,i=o.getLocationId;if(n)return n;var r=e.getLocationTotals(t).within;return function(t){return r[i(t)]||0}},this.getLocationMaxAbsTotalGetter=Object(G.a)([gt,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],(function(t,e,o,n){return function(t){return Math.max(Math.abs(e(t)+n(t)),Math.abs(o(t)+n(t)))}})),this.getMaxLocationMaxAbsTotal=Object(G.a)([gt,this.getLocationMaxAbsTotalGetter],(function(t,e){return Object(x.a)(t,e)||0})),this.getLocationCircles=Object(G.a)([gt,this.getLocationMaxAbsTotalGetter],(function(t,e){for(var o=[],n=0,i=t.slice().sort((function(t,o){return Object(k.a)(e(t),e(o))}));n<i.length;n++){var r=i[n];o.push({location:r,type:"outline"}),o.push({location:r,type:"outer"}),o.push({location:r,type:"inner"})}return o})),this.getSizeScale=Object(G.a)([vt,this.getMaxLocationMaxAbsTotal],(function(t,e){var o=Object(D.a)().exponent(.5).domain([0,e]).range([0,e>0?t:1]);return function(t){return o(Math.abs(t))}})),this.getLocationCircleRadiusGetter=Object(G.a)([this.getSizeScale,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],(function(t,e,o,n){return function(i){var r=i.location,a=i.type,s="inner"===a?Math.min:Math.max,c=e(r),l=o(r),u=n(r),g=t(s(Math.abs(c+u),Math.abs(l+u)));return"outline"===a?g+1:g}})),this.getLocationCircleColorGetter=Object(G.a)([this.getColors,ht,this.getLocationTotalInGetter,this.getLocationTotalOutGetter,this.getLocationTotalWithinGetter],(function(t,o,n,i,r){var a=e.inputAccessors.getLocationId;return function(e){var s,c,l=e.location,u=e.type,g=o&&o===a(l),p=o&&o!==a(l),d=r(l),h=n(l)+d,f=i(l)+d,m="outer"===u&&Math.abs(h)>Math.abs(f),v=!0===m&&h>=0||f>=0,y=(Z(t)?v?t.positive:t.negative:t).locationCircles;return g&&"outline"===u?y.highlighted:p?"outline"===u?(s=t.outlineColor,c=t.dimmedOpacity,[s[0],s[1],s[2],s[3]*c*.5]):function(t,e){return it(t,.5*e)}(y.inner,t.dimmedOpacity):"outline"===u?m?y.incoming:y.inner:"inner"===u?y.inner:!0===m?y.incoming:y.outgoing}})),this.isLocationConnectedGetter=Object(G.a)([this.getFilteredFlows,ht,dt,ft],(function(t,o,n,i){var r=e.inputAccessors,a=r.getFlowOriginId,s=r.getFlowDestId;if(o){for(var c=function(t){var e=a(t),n=s(t);return e===o||i&&i.indexOf(e)>=0||n===o||i&&i.indexOf(n)>=0},l=new Set,u=0,g=t;u<g.length;u++){var p=g[u];c(p)&&(l.add(a(p)),l.add(s(p)))}return function(t){return l.has(t)}}return function(){return!1}})),this.getLocationAreaFillColorGetter=Object(G.a)([this.getColors,ft,this.isLocationConnectedGetter],(function(t,o,n){return function(i){var r=e.inputAccessors.getLocationId(i);return o&&o.indexOf(r)>=0?t.locationAreas.selected:n(r)?t.locationAreas.connected:t.locationAreas.normal}}))}return t.prototype.getFlowLinesColorGetter=function(t,e,o,n){var i=this.inputAccessors,r=i.getFlowMagnitude,a=i.getFlowColor;return function(i){if(a&&(u=a(i)))return Q(u);if(o){if(Z(t)){var s=t.positive.flows.highlighted,c=t.negative.flows.highlighted;return(l=r(i))>=0?s:c}return t.flows.highlighted}var l=r(i),u=e(l);return n?it(u,t.dimmedOpacity):u}},t.prototype.setInputAccessors=function(t){this.inputAccessors=t},t.prototype.getInputAccessors=function(){return this.inputAccessors},t}(),Lt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),wt=function(){return(wt=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};!function(t){t.LOCATIONS="LOCATIONS",t.LOCATION_AREAS="LOCATION_AREAS",t.LOCATION_AREAS_OUTLINES="LOCATION_AREAS_OUTLINES",t.LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED="LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED",t.FLOWS="FLOWS",t.LOCATIONS_HIGHLIGHTED="LOCATIONS_HIGHLIGHTED",t.FLOWS_HIGHLIGHTED="FLOWS_HIGHLIGHTED"}(st||(st={}));function Ct(t,e){return t+":::"+e.valueOf()}function Ot(t){switch(function(t){var e=t.substr(t.lastIndexOf(":::")+":::".length);return st[e]}(t.id)){case st.FLOWS:case st.FLOWS_HIGHLIGHTED:return n.FLOW;case st.LOCATIONS:case st.LOCATIONS_HIGHLIGHTED:return n.LOCATION;case st.LOCATION_AREAS:return n.LOCATION_AREA;default:return}}var bt=function(t){function e(e){return t.call(this,e)||this}return Lt(e,t),e.prototype.initializeState=function(){var t=this.props,e=t.getLocationTotalIn,o=t.getLocationTotalOut,n=t.getLocationTotalWithin,i=t.getLocationId,r=t.getLocationCentroid,a=t.getFlowOriginId,s=t.getFlowDestId,c=t.getFlowMagnitude,l=t.getFlowColor,u=new yt({getLocationId:i,getLocationCentroid:r,getLocationTotalIn:e,getLocationTotalOut:o,getLocationTotalWithin:n,getFlowOriginId:a,getFlowDestId:s,getFlowMagnitude:c,getFlowColor:l});this.setState({selectors:u})},e.prototype.updateState=function(e){t.prototype.updateState.call(this,e);var o=e.props;if(e.changeFlags.propsChanged){var n=o.getLocationTotalIn,i=o.getLocationTotalOut,r=o.getLocationTotalWithin,a=o.getLocationId,s=o.getLocationCentroid,c=o.getFlowOriginId,l=o.getFlowDestId,u=o.getFlowMagnitude,g=o.getFlowColor;this.state.selectors.setInputAccessors({getLocationId:a,getLocationCentroid:s,getLocationTotalIn:n,getLocationTotalOut:i,getLocationTotalWithin:r,getFlowOriginId:c,getFlowDestId:l,getFlowMagnitude:u,getFlowColor:g})}},e.prototype.getPickingInfo=function(t){var e=Ot(t.sourceLayer);if(!e)return t.info;var o=wt(wt({},t.info),{type:e}),i=this.state.selectors;if(e===n.FLOW){var r=i.getLocationByIdGetter(this.props),a=i.getInputAccessors(),s=a.getFlowOriginId,c=a.getFlowDestId,l=o.object;return wt(wt({},o),l&&{origin:r(s(l)),dest:r(c(l))})}if(e===n.LOCATION||e===n.LOCATION_AREA){var u=e===n.LOCATION?o.object&&o.object.location:o.object,g=i.getLocationTotalInGetter(this.props),p=i.getLocationTotalOutGetter(this.props),d=i.getLocationTotalWithinGetter(this.props),h=i.getLocationCircleRadiusGetter(this.props);return wt(wt({},o),u&&{object:u,totalIn:g(u),totalOut:p(u),totalWithin:d(u),circleRadius:h({location:u,type:"outer"})})}return o},e.prototype.renderLayers=function(){var t=this.props,e=t.showLocationAreas,o=t.locations,n=t.highlightedLocationId,i=this.state.selectors,r=i.getTopFlows(this.props),a=i.getHighlightedFlows(this.props),s=null!=n,c=i.getLocationCircles(this.props),l=[];if(e&&at(o)&&l.push(this.getLocationAreasLayer(Ct(this.props.id,st.LOCATION_AREAS),!1)),l.push(this.getFlowLinesLayer(Ct(this.props.id,st.FLOWS),r,!1,s)),e&&at(o)&&l.push(this.getHighlightedLocationAreasLayer(Ct(this.props.id,st.LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED))),a&&l.push(this.getFlowLinesLayer(Ct(this.props.id,st.FLOWS_HIGHLIGHTED),a,!0,!1)),l.push(this.getLocationCirclesLayer(Ct(this.props.id,st.LOCATIONS),c,!1)),s){var u=i.getHighlightedLocationCircles(this.props);l.push(this.getLocationCirclesLayer(Ct(this.props.id,st.LOCATIONS_HIGHLIGHTED),u,!0))}return e&&at(o)&&l.push(this.getLocationAreasLayer(Ct(this.props.id,st.LOCATION_AREAS_OUTLINES),!0)),l},e.prototype.getLocationAreasLayer=function(t,e){var o=this.props,n=o.locations,i=o.selectedLocationIds,r=o.highlightedLocationId,a=o.highlightedFlow,s=o.updateTriggers,c=this.state.selectors,l=c.getColors(this.props);return new d.a(this.getSubLayerProps(wt(wt({id:t,getFillColor:c.getLocationAreaFillColorGetter(this.props),getLineColor:l.locationAreas.outline,lineJointRounded:!0,data:n,stroked:e,filled:!e},e&&{pickable:!1}),{lineWidthMinPixels:1,pointRadiusMinPixels:1,updateTriggers:{getFillColor:wt(wt({colors:l},e&&{selectedLocationIds:i,highlightedLocationId:r,highlightedFlow:a}),null===s||void 0===s?void 0:s.getLocationAreasFillColor),getLineColor:wt({colors:l},null===s||void 0===s?void 0:s.getLocationAreasLineColor)}})))},e.prototype.getHighlightedLocationAreasLayer=function(t){var e=this.state.selectors,o=this.props,n=o.highlightedLocationId,i=o.highlightedLocationAreaId,r=o.updateTriggers,a=e.getColors(this.props),s=e.getLocationByIdGetter(this.props);return new d.a(this.getSubLayerProps({id:t,getFillColor:function(){return a.locationAreas.highlighted},getLineColor:a.locationAreas.outline,lineJointRounded:!0,data:n?s(n):i?s(i):void 0,stroked:!1,filled:!0,pickable:!1,lineWidthMinPixels:5,updateTriggers:{getFillColor:wt({colors:a},null===r||void 0===r?void 0:r.getLocationAreasFillColor),getLineColor:wt({colors:a},null===r||void 0===r?void 0:r.getLocationAreasLineColor)}}))},e.prototype.getFlowLinesLayer=function(t,e,o,n){var i=this.props,r=i.getFlowOriginId,a=i.getFlowDestId,s=i.getFlowMagnitude,c=i.getLocationCentroid,l=i.getAnimatedFlowLineStaggering,u=i.showTotals,g=i.maxLocationCircleSize,p=i.outlineThickness,d=i.minPickableFlowThickness,h=i.maxFlowThickness,f=i.updateTriggers,m=this.state.selectors,v=[(g||0)+1,(g||0)+1],y=m.getLocationCircleRadiusGetter(this.props),L=m.getLocationByIdGetter(this.props),w=m.getFlowThicknessScale(this.props),C=function(t,e){return w(s(t,e))},O=m.getFlowColorScale(this.props),I=m.getColors(this.props),T=m.getFlowLinesColorGetter(I,O,o,n),_=this.props.animate,S=null!=h?h:P.defaultProps.thicknessUnit,F=wt(wt(wt(wt(wt({id:t,getSourcePosition:function(t,e){return c(L(r(t,e)))},getTargetPosition:function(t,e){return c(L(a(t,e)))},getThickness:C,getEndpointOffsets:function(t,e){return u?[y({location:L(r(t,e)),type:"outline"}),y({location:L(a(t,e)),type:"outline"})]:v},getColor:T,data:e},o&&{pickable:!1}),{drawOutline:!n,updateTriggers:{getSourcePosition:null===f||void 0===f?void 0:f.getFlowLinesSourcePosition,getTargetPosition:null===f||void 0===f?void 0:f.getFlowLinesTargetPosition,getThickness:wt({maxFlowThickness:h},null===f||void 0===f?void 0:f.getFlowLinesThickness),getColor:wt({colors:I,dimmed:n},null===f||void 0===f?void 0:f.getFlowLinesColor),getEndpointOffsets:wt({showTotals:u},null===f||void 0===f?void 0:f.getFlowLinesEndpointOffsets)},thicknessUnit:S,outlineColor:I.outlineColor}),p&&{outlineThickness:p}),null!=d&&{getPickable:function(t){return S*C(t)>=d?1:0}}),{parameters:wt(wt({},this.props.parameters),{depthTest:!1})});return _?new b(this.getSubLayerProps(wt(wt(wt({},F),{currentTime:this.props.animationCurrentTime,tailLength:this.props.tailLength}),l&&{getStaggering:l}))):new P(this.getSubLayerProps(F))},e.prototype.getLocationCirclesLayer=function(t,e,o){var n=this.props,i=n.highlightedLocationId,r=n.selectedLocationIds,a=n.getLocationCentroid,s=n.flows,c=n.showTotals,l=n.updateTriggers,u=n.maxLocationCircleSize,g=this.state.selectors,p=c?g.getLocationCircleRadiusGetter(this.props):function(){return u},d=g.getColors(this.props),h=g.getLocationCircleColorGetter(this.props);return new _(this.getSubLayerProps({id:t,getColor:h,getPosition:function(t){return a(t.location)},getRadius:p,data:e,updateTriggers:{getRadius:wt({showTotals:c,selectedLocationIds:r,maxLocationCircleSize:u,flows:s},null===l||void 0===l?void 0:l.getCirclesRadius),getColor:wt({colors:d,highlightedLocationId:i,selectedLocationIds:r,flows:s},null===l||void 0===l?void 0:l.getCirclesColor)},parameters:wt(wt({},this.props.parameters),{depthTest:!1})}))},e.layerName="FlowMapLayer",e.defaultProps={getLocationId:{type:"accessor",value:function(t){return t.id||t.properties.id}},getLocationCentroid:{type:"accessor",value:function(t){return t.properties.centroid}},getFlowOriginId:{type:"accessor",value:function(t){return t.origin}},getFlowDestId:{type:"accessor",value:function(t){return t.dest}},getFlowMagnitude:{type:"accessor",value:function(t){return t.count}},showTotals:!0,maxLocationCircleSize:15,outlineThickness:1,showLocationAreas:!0,tailLength:.7},e}(p.a),It=bt,Tt=o(6),_t=o.n(Tt),St=function(t){var e=t.size,o=t.inner,n=t.outer,i=t.outline;return Tt.createElement("svg",{width:e,height:e,style:{marginRight:5}},Tt.createElement("circle",{cx:e/2,cy:e/2,r:.5*e,fill:et(i)}),Tt.createElement("circle",{cx:e/2,cy:e/2,r:.5*e-1,fill:et(n)}),Tt.createElement("circle",{cx:e/2,cy:e/2,r:.5*e*.6-1,fill:et(o)}))},Ft={outer:{display:"flex",flexDirection:"column"},item:{outer:{display:"flex",flexDirection:"row",padding:"3px 0",alignItems:"center"},caption:{marginLeft:2}}},At=function(t){var e=t.diff,o=t.colors,n=t.aboutEqualText,i=t.moreOutgoingText,r=t.moreIncomingText,a=e?q(o):Y(o),s=Z(a)?a.positive.locationCircles:a.locationCircles,c=Z(a)?a.negative.locationCircles:void 0;return Tt.createElement("div",{style:Ft.outer},Tt.createElement("div",null,Tt.createElement("div",{style:Ft.item.outer},Tt.createElement(St,{size:20,inner:s.inner,outer:s.inner,outline:s.inner}),c&&Tt.createElement(St,{size:20,inner:c.inner,outer:c.inner,outline:c.inner}),Tt.createElement("div",{style:Ft.item.caption},n||"outgoing \u2245 incoming")),Tt.createElement("div",{style:Ft.item.outer},Tt.createElement(St,{size:20,inner:s.inner,outer:s.outgoing,outline:s.inner}),c&&Tt.createElement(St,{size:20,inner:c.inner,outer:c.outgoing,outline:c.inner}),Tt.createElement("div",{style:Ft.item.caption},i||"more outgoing")),Tt.createElement("div",{style:Ft.item.outer},Tt.createElement(St,{size:20,inner:s.inner,outer:s.incoming,outline:s.incoming}),c&&Tt.createElement(St,{size:20,inner:c.inner,outer:c.incoming,outline:c.incoming}),Tt.createElement("div",{style:Ft.item.caption},r||"more incoming"))))},Pt=function(){return(Pt=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Et={position:"absolute",background:"#fff",padding:10,borderRadius:4,border:"1px solid #ccc"},xt=function(t){var e=t.style,o=t.top,n=t.left,i=t.right,r=t.bottom,a=t.children;return _t.a.createElement("div",{style:Pt(Pt(Pt({},Et),e),{top:o,left:n,right:i,bottom:r})},a)};o(138),o(202);var kt=o(198),Mt=o(140),jt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Dt=function(){return(Dt=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var i in e=arguments[o])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Gt=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(o[n[i]]=t[n[i]])}return o},Nt=function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<o;e++)for(var r=arguments[e],a=0,s=r.length;a<s;a++,i++)n[i]=r[a];return n},Rt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={viewState:e.props.initialViewState,time:0},e.animationFrame=-1,e.animate=function(){var t=Date.now()/1e3;e.setState({time:t%60/60*1800}),e.animationFrame=window.requestAnimationFrame(e.animate)},e.handleFlowMapHover=function(t){var o=t.type,i=t.object;switch(o){case n.FLOW:i?e.highlight({type:"flow",flow:i},t):e.highlight(void 0);break;case n.LOCATION_AREA:case n.LOCATION:var r=e.props.getLocationId;i?e.highlight({type:o===n.LOCATION_AREA?"locationArea":"location",locationId:(r||It.defaultProps.getLocationId.value)(i)},t):e.highlight(void 0)}},e.handleFlowMapClick=function(t){var o=t.type,i=t.object;switch(o){case n.LOCATION_AREA:case n.LOCATION:if(i){var r=e.props,a=r.getLocationId,s=r.multiselect,c=e.state.selectedLocationIds,l=(a||It.defaultProps.getLocationId.value)(i),u=c&&c.indexOf(l)>=0,g=void 0;g=s?c?u?c.filter((function(t){return t!==l})):Nt(c,[l]):[l]:u?void 0:[l],e.selectLocations(g),e.highlight(void 0)}}},e.handleViewStateChange=function(t){var o=t.viewState;e.setState({viewState:o,highlight:void 0});var n=e.props.onViewStateChange;n&&n(o)},e.handleKeyDown=function(t){t instanceof KeyboardEvent&&"Escape"===t.key&&e.setState({selectedLocationIds:void 0,highlight:void 0})},e}return jt(e,t),e.getDerivedStateFromProps=function(t,e){return t.selectedLocationIds!==e.selectedLocationIds?{selectedLocationIds:t.selectedLocationIds}:null},e.prototype.componentDidMount=function(){document.addEventListener("keydown",this.handleKeyDown),this.props.animate&&this.animate();var t=this.props.onViewStateChange;if(t){var e=this.state.viewState;e&&t(e)}},e.prototype.componentDidUpdate=function(t,e,o){var n=this.props.animate;n!==t.animate&&(n?this.animate():this.stopAnimation())},e.prototype.componentWillUnmount=function(){document.removeEventListener("keydown",this.handleKeyDown),this.stopAnimation()},e.prototype.render=function(){var t=this.props,e=t.mapboxAccessToken,o=t.mapStyle,n=t.mixBlendMode,i=this.getFlowMapLayer();return Tt.createElement(Tt.Fragment,null,Tt.createElement(kt.a,{style:{mixBlendMode:n},layers:[i],viewState:this.state.viewState,controller:!0,onViewStateChange:this.handleViewStateChange},Tt.createElement(Mt.a,{width:"100%",height:"100%",mapboxApiAccessToken:e,mapStyle:o})))},e.prototype.stopAnimation=function(){this.animationFrame&&window.cancelAnimationFrame(this.animationFrame)},e.prototype.getFlowMapLayer=function(){var t=this.props,e=(t.initialViewState,t.mapboxAccessToken,t.mixBlendMode,t.multiselect,t.tailLength),o=(t.onSelected,t.onHighlighted,Gt(t,["initialViewState","mapboxAccessToken","mixBlendMode","multiselect","tailLength","onSelected","onHighlighted"])),n=this.state,i=n.highlight,r=n.selectedLocationIds;return new It(Dt(Dt({id:"flow-map-layer",animationCurrentTime:this.state.time},o),{selectedLocationIds:r,tailLength:e||.7,highlightedLocationId:i&&"location"===i.type?i.locationId:void 0,highlightedLocationAreaId:i&&"locationArea"===i.type?i.locationId:void 0,highlightedFlow:i&&"flow"===i.type?i.flow:void 0,onHover:this.handleFlowMapHover,onClick:this.handleFlowMapClick}))},e.prototype.highlight=function(t,e){this.setState({highlight:t});var o=this.props.onHighlighted;o&&o(t,e)},e.prototype.selectLocations=function(t){this.setState((function(e){return Dt(Dt({},e),{selectedLocationIds:t})}));var e=this.props.onSelected;e&&e(t)},e.defaultProps={mixBlendMode:"multiply"},e}(Tt.Component),zt=o(200);const Ht={position:"absolute",pointerEvents:"none",zIndex:1,background:"#125",color:"#fff",fontSize:9,borderRadius:4,padding:5,maxWidth:300,maxHeight:300,overflow:"hidden",boxShadow:"2px 2px 4px #ccc"},Ut={flows:{scheme:zt.a[zt.a.length-1].slice().reverse()}};class Wt extends r.a.Component{constructor(t){super(t),this.state={tooltip:void 0},this.initialViewState=void 0,this.handleViewStateChange=t=>{const e=this.props.onViewStateChange;e&&e(t);this.state.tooltip&&this.setState({tooltip:void 0})},this.handleHighlight=(t,e)=>{e||this.setState({tooltip:void 0}),this.setState({})},this.initialViewState={latitude:-41.235726,longitude:172.5118422,zoom:5,bearing:0,pitch:0}}renderTooltip(){const t=this.state.tooltip;if(!t)return null;const e=t.object,o=t.x,n=t.y;return e?r.a.createElement("pre",{style:Object(g.a)({},Ht,{left:o,top:n})},JSON.stringify(e,null,2)):null}render(){const t=this.props,e=t.flows,o=t.locations,n=t.getLocationId,i=t.getLocationCentroid,a=t.getFlowMagnitude;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Rt,{pickable:!0,initialViewState:this.initialViewState,showTotals:!0,colors:Ut,flows:e,locations:o,mapStyle:"mapbox://styles/mapbox/dark-v10",animate:!0,opacity:1,mixBlendMode:"screen",mapboxAccessToken:"pk.eyJ1IjoibnlvdTA0NSIsImEiOiJjaXJ6bDYxeWcwMXRzMnlwa2tmbzduNmd0In0.gLrTUpqhS3PYYy_AtCp4Gw",getLocationId:n,getLocationCentroid:i,getFlowMagnitude:a,onViewStateChange:this.handleViewStateChange,onHighlighted:this.handleHighlight}),r.a.createElement(xt,{bottom:35,right:10},r.a.createElement(At,{colors:Ut}),r.a.createElement("div",{className:"source"},"Source: ",r.a.createElement("a",{href:"https://datafinder.stats.govt.nz/table/104720-2018-census-main-means-of-travel-to-work-by-statistical-area-2/data/"},"Stats NZ"))),this.renderTooltip())}}function Bt(t,e){var o;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(o=function(t,e){if(!t)return;if("string"===typeof t)return Vt(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return Vt(t,e)}(t))||e&&t&&"number"===typeof t.length){o&&(t=o);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){o=t[Symbol.iterator]()},n:function(){var t=o.next();return a=t.done,t},e:function(t){s=!0,r=t},f:function(){try{a||null==o.return||o.return()}finally{if(s)throw r}}}}function Vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}class Kt extends r.a.Component{constructor(t){super(t),this.clusterIndex=void 0,this.aggregateFlowsByZoom=void 0,this.handleViewStateChange=t=>{const e=this.clusterIndex.availableZoomLevels,o=t.zoom;var n=u.c(e,o);n>12&&(n=12),this.setState({clusteredLocations:this.clusterIndex.getClusterNodesFor(n),aggregateFlows:this.aggregateFlowsByZoom.get(n)})};const e=this.props,o=e.flows,n=e.getLocationId,i=e.getLocationCentroid,r=e.getFlowOriginId,a=e.getFlowDestId,s=e.getFlowMagnitude;let c;const l=this.props.locations;if(this.props.clusterLevels)c=this.props.clusterLevels;else{const t=u.e(o,{getFlowOriginId:r,getFlowDestId:a,getFlowMagnitude:s});c=u.b(l,{getLocationId:n,getLocationCentroid:i},t,{makeClusterName:(t,e)=>"Cluster #".concat(t," of ").concat(e," locations")})}const g=u.a(c),p=new Map;var d,h=Bt(g.availableZoomLevels);try{for(h.s();!(d=h.n()).done;){const t=d.value;p.set(t,g.aggregateFlows(o,t,{getFlowOriginId:r,getFlowDestId:a,getFlowMagnitude:s}))}}catch(m){h.e(m)}finally{h.f()}const f=Math.max.apply(null,g.availableZoomLevels);this.clusterIndex=g,this.aggregateFlowsByZoom=p,this.state={clusteredLocations:this.clusterIndex.getClusterNodesFor(f),aggregateFlows:this.aggregateFlowsByZoom.get(f)}}render(){const t=this.props,e=t.getFlowOriginId,o=t.getFlowDestId,n=t.getFlowMagnitude,i=this.state,a=i.clusteredLocations,s=i.aggregateFlows;return a&&s?r.a.createElement(Wt,{locations:a,flows:s,getLocationId:t=>t.id,getLocationCentroid:t=>t.centroid,getFlowOriginId:t=>u.d(t)?t.origin:e(t),getFlowDestId:t=>u.d(t)?t.dest:o(t),getFlowMagnitude:t=>u.d(t)?t.count:n(t),onViewStateChange:this.handleViewStateChange}):null}}var Zt=Kt;o(175);l.a.parsePromise=function(t){return new Promise((function(e,o){l.a.parse(t,{download:!0,header:!0,dynamicTyping:!0,skipEmptyLines:!0,complete:e,error:o})}))};class Jt extends i.Component{constructor(...t){super(...t),this.state={locations:null,flows:null,time:0}}componentDidMount(){Promise.all([l.a.parsePromise("https://neon-ninja.github.io/TABA/travel.csv"),l.a.parsePromise("https://neon-ninja.github.io/TABA/sa2_centroids.csv")]).then(([t,e])=>{console.log(t,e,this.state),this.setState({flows:t.data,locations:e.data})})}render(){const t=this.state,e=t.locations,o=t.flows;return e&&o?r.a.createElement(Zt,{locations:e,flows:o,getLocationId:t=>t.code,getLocationCentroid:t=>[t.longitude,t.latitude],getFlowOriginId:t=>t.home_SA2,getFlowDestId:t=>t.work_SA2,getFlowMagnitude:t=>t.Total}):null}}s.a.render(r.a.createElement(Jt,null),document.getElementById("root")),document.write('<h1 id="title">There and back again - a visualisation of the 2018 NZ census commuter data</h1>\n   <a href="https://github.com/neon-ninja/TABA">\n    <img \n      style="position: absolute; top: 0; right: 0; border: 0;" \n      src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" \n      alt="Fork me on GitHub">\n   </a>\n ')}},[[160,1,2]]]);
//# sourceMappingURL=main.4c135ac6.chunk.js.map