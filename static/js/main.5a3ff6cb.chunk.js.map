{"version":3,"sources":["../../src/types.ts","../../../src/AnimatedFlowLinesLayer/AnimatedFlowLinesLayer.ts","../../../src/AnimatedFlowLinesLayer/AnimatedFlowLinesLayerVertex.glsl.ts","../../../src/AnimatedFlowLinesLayer/AnimatedFlowLinesLayerFragment.glsl.ts","../../../src/FlowCirclesLayer/FlowCirclesLayer.ts","../../../src/FlowCirclesLayer/FlowCirclesLayerVertex.glsl.ts","../../../src/FlowCirclesLayer/FlowCirclesLayerFragment.glsl.ts","../../../src/FlowLinesLayer/FlowLinesLayer.ts","../../../src/FlowLinesLayer/FlowLinesLayerVertex.glsl.ts","../../../src/FlowLinesLayer/FlowLinesLayerFragment.glsl.ts","../../src/colors.ts","../../src/Selectors.ts","../../src/FlowMapLayer.ts","../../src/index.ts","../../../src/legend/Disc.tsx","../../../src/legend/LocationTotalsLegend.tsx","../../../src/legend/LegendBox.tsx","../../src/FlowMap.tsx","Example.tsx","ClusteringExample.tsx","App.js","index.js"],"names":["accessor","tailLength","FlowCirclesLayer","_a","position","background","padding","borderRadius","border","tooltipStyle","pointerEvents","zIndex","color","fontSize","maxWidth","maxHeight","overflow","boxShadow","DARK_COLORS","flows","scheme","d3scaleChromatic","length","slice","reverse","highlighted","dimmedOpacity","Example","React","Component","constructor","props","super","state","tooltip","undefined","initialViewState","handleViewStateChange","viewState","onViewStateChange","this","setState","handleHighlight","highlight","info","console","log","latitude","longitude","zoom","bearing","pitch","renderTooltip","object","x","y","style","left","top","JSON","stringify","render","locations","getLocationId","getLocationCentroid","getFlowMagnitude","pickable","showTotals","colors","mapStyle","animate","opacity","mixBlendMode","mapboxAccessToken","process","onHighlighted","bottom","right","className","href","ClusteringExample","clusterIndex","aggregateFlowsByZoom","availableZoomLevels","clusterZoom","Cluster","clusteredLocations","getClusterNodesFor","aggregateFlows","get","getFlowOriginId","getFlowDestId","clusterLevels","getLocationWeight","makeClusterName","id","numPoints","Map","set","maxZoom","Math","max","apply","flippedFlows","f","aggregate","push","origin","dest","count","home_SA2","work_SA2","Total","flip","loc","centroid","flow","type","checked","onChange","evt","target","Papa","parsePromise","file","Promise","complete","error","parse","download","header","dynamicTyping","skipEmptyLines","App","time","componentDidMount","all","then","travel","sa2_centroids","data","code","ReactDOM","document","getElementById","write"],"mappings":"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","file":"static/js/main.5a3ff6cb.chunk.js","sourcesContent":["/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nexport function isFeatureCollection(locations) {\n    return locations.type === 'FeatureCollection';\n}\nexport var PickingType;\n(function (PickingType) {\n    PickingType[\"LOCATION\"] = \"location\";\n    PickingType[\"FLOW\"] = \"flow\";\n    PickingType[\"LOCATION_AREA\"] = \"location-area\";\n})(PickingType || (PickingType = {}));\n//# sourceMappingURL=types.js.map","/*\n * Copyright 2019 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\n/*\n * This file was modified by Teralytics. The original file is licenced under:\n *\n * Copyright (c) 2015-2017 Uber Technologies, Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nimport { Layer, picking, project32 } from '@deck.gl/core';\nimport { TRIANGLE_STRIP, UNSIGNED_BYTE } from '@luma.gl/constants';\nimport { Geometry, Model } from '@luma.gl/core';\nimport FragmentShader from './AnimatedFlowLinesLayerFragment.glsl';\nimport VertexShader from './AnimatedFlowLinesLayerVertex.glsl';\nvar DEFAULT_COLOR = [0, 132, 193, 255];\nvar AnimatedFlowLinesLayer = /** @class */ (function (_super) {\n    __extends(AnimatedFlowLinesLayer, _super);\n    function AnimatedFlowLinesLayer(props) {\n        return _super.call(this, props) || this;\n    }\n    AnimatedFlowLinesLayer.prototype.getShaders = function () {\n        return _super.prototype.getShaders.call(this, {\n            vs: VertexShader,\n            fs: FragmentShader,\n            modules: [project32, picking],\n            shaderCache: this.context.shaderCache,\n        });\n    };\n    AnimatedFlowLinesLayer.prototype.initializeState = function () {\n        var attributeManager = this.getAttributeManager();\n        /* eslint-disable max-len */\n        attributeManager.addInstanced({\n            instanceSourcePositions: {\n                size: 3,\n                transition: true,\n                accessor: 'getSourcePosition',\n            },\n            instanceTargetPositions: {\n                size: 3,\n                transition: true,\n                accessor: 'getTargetPosition',\n            },\n            instanceColors: {\n                size: 4,\n                type: UNSIGNED_BYTE,\n                transition: true,\n                accessor: 'getColor',\n                defaultValue: [0, 0, 0, 255],\n            },\n            instanceWidths: {\n                size: 1,\n                transition: true,\n                accessor: 'getThickness',\n                defaultValue: 1,\n            },\n            instanceStaggering: {\n                accessor: 'getStaggering',\n                size: 1,\n                transition: false,\n            },\n            instancePickable: {\n                accessor: 'getPickable',\n                size: 1,\n                transition: false,\n            },\n        });\n        /* eslint-enable max-len */\n    };\n    AnimatedFlowLinesLayer.prototype.updateState = function (_a) {\n        var props = _a.props, oldProps = _a.oldProps, changeFlags = _a.changeFlags;\n        _super.prototype.updateState.call(this, { props: props, oldProps: oldProps, changeFlags: changeFlags });\n        if (changeFlags.extensionsChanged) {\n            var gl = this.context.gl;\n            if (this.state.model) {\n                this.state.model.delete();\n            }\n            this.setState({ model: this._getModel(gl) });\n            this.getAttributeManager().invalidateAll();\n        }\n    };\n    AnimatedFlowLinesLayer.prototype.draw = function (_a) {\n        var uniforms = _a.uniforms;\n        var _b = this.props, currentTime = _b.currentTime, thicknessUnit = _b.thicknessUnit, tailLength = _b.tailLength;\n        this.state.model\n            .setUniforms(__assign(__assign({}, uniforms), { thicknessUnit: thicknessUnit * 4, tailLength: tailLength, currentTime: currentTime }))\n            .draw();\n    };\n    AnimatedFlowLinesLayer.prototype._getModel = function (gl) {\n        /*\n         *  (0, -1)-------------_(1, -1)\n         *       |          _,-\"  |\n         *       o      _,-\"      o\n         *       |  _,-\"          |\n         *   (0, 1)\"-------------(1, 1)\n         */\n        var positions = [0, -1, 0, 0, 1, 0, 1, -1, 0, 1, 1, 0];\n        return new Model(gl, Object.assign({}, this.getShaders(), {\n            id: this.props.id,\n            geometry: new Geometry({\n                drawMode: TRIANGLE_STRIP,\n                attributes: {\n                    positions: new Float32Array(positions),\n                },\n            }),\n            isInstanced: true,\n        }));\n    };\n    AnimatedFlowLinesLayer.defaultProps = {\n        currentTime: 0,\n        tailLength: .7,\n        getSourcePosition: { type: 'accessor', value: function (d) { return d.sourcePosition; } },\n        getTargetPosition: { type: 'accessor', value: function (d) { return d.targetPosition; } },\n        getPickable: { type: 'accessor', value: function (d) { return 1.0; } },\n        getStaggering: { type: 'accessor', value: function (d, _a) {\n                var index = _a.index;\n                return Math.random();\n            } },\n        getColor: { type: 'accessor', value: DEFAULT_COLOR },\n        getThickness: { type: 'accessor', value: 1 },\n        thicknessUnit: 15 * 2,\n        parameters: {\n            depthTest: false,\n        },\n    };\n    return AnimatedFlowLinesLayer;\n}(Layer));\nexport default AnimatedFlowLinesLayer;\n//# sourceMappingURL=AnimatedFlowLinesLayer.js.map","/*\n * Copyright 2019 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n/*\n * This file was modified by Teralytics. The original file is licenced under:\n *\n * Copyright (c) 2015-2017 Uber Technologies, Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nexport default \"#define SHADER_NAME animated-flow-lines-layer-vertex-shader\\n#define SPEED 0.015\\n#define NUM_PARTS 5.0\\n\\nattribute vec3 positions;\\nattribute vec3 instanceSourcePositions;\\nattribute vec3 instanceTargetPositions;\\nattribute vec3 instanceSourcePositions64Low;\\nattribute vec3 instanceTargetPositions64Low;\\nattribute vec4 instanceColors;\\nattribute vec3 instancePickingColors;\\nattribute float instanceWidths;\\nattribute float instancePickable;\\nattribute float instanceStaggering;\\n\\nuniform float opacity;\\nuniform float currentTime;\\nuniform float thicknessUnit;\\n    \\nvarying vec4 vColor;\\nvarying float sourceToTarget;\\nvarying vec2 uv;\\n\\n// offset vector by strokeWidth pixels\\n// offset_direction is -1 (left) or 1 (right)\\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\\n  // normalized direction of the line\\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\\n  // rotate by 90 degrees\\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\\n\\n  return dir_screenspace * offset_direction * width / 2.0;\\n}\\n\\nvoid main(void) {\\n  geometry.worldPosition = instanceSourcePositions;\\n  geometry.worldPositionAlt = instanceTargetPositions;\\n\\n  // Position\\n  vec4 source_commonspace;\\n  vec4 target_commonspace;\\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);\\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);\\n\\n  float widthPixels = instanceWidths * thicknessUnit;\\n  \\n  \\n  // linear interpolation of source & target to pick right coord\\n  float segmentIndex = positions.x;\\n  vec4 p = mix(source, target, segmentIndex);\\n  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);\\n  uv = positions.xy;\\n  geometry.uv = uv;\\n  if (instancePickable > 0.5) {\\n    geometry.pickingColor = instancePickingColors;\\n  }\\n  \\n  // extrude\\n  vec3 offset = vec3(\\n    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),\\n    0.0);\\n  DECKGL_FILTER_SIZE(offset, geometry);\\n  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);\\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\\n\\n  // Color\\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\\n  DECKGL_FILTER_COLOR(vColor, geometry);\\n\\n  sourceToTarget = positions.x * length(source - target) * NUM_PARTS - currentTime * SPEED + instanceStaggering; \\n}\\n\";\n//# sourceMappingURL=AnimatedFlowLinesLayerVertex.glsl.js.map","/*\n * Copyright 2019 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n/*\n * This file was modified by Teralytics. The original file is licenced under:\n *\n * Copyright (c) 2015-2017 Uber Technologies, Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nexport default \"#define SHADER_NAME animated-flow-lines-layer-fragment-shader\\n\\nprecision highp float;\\n\\nuniform float tailLength;\\n\\nvarying vec4 vColor;\\nvarying float sourceToTarget;\\nvarying vec2 uv;\\n                                   \\nvoid main(void) {\\n  geometry.uv = uv;\\n\\n  gl_FragColor = vec4(vColor.xyz, vColor.w * smoothstep(1.0 - tailLength, 1.0, fract(sourceToTarget)));\\n\\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\\n}\\n\";\n//# sourceMappingURL=AnimatedFlowLinesLayerFragment.glsl.js.map","/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Layer, picking, project32 } from '@deck.gl/core';\nimport { DOUBLE, TRIANGLE_FAN, UNSIGNED_BYTE } from '@luma.gl/constants';\nimport { Geometry, Model } from '@luma.gl/core';\nimport FragmentShader from './FlowCirclesLayerFragment.glsl';\nimport VertexShader from './FlowCirclesLayerVertex.glsl';\nvar DEFAULT_COLOR = [0, 0, 0, 255];\nvar FlowCirclesLayer = /** @class */ (function (_super) {\n    __extends(FlowCirclesLayer, _super);\n    function FlowCirclesLayer(props) {\n        return _super.call(this, props) || this;\n    }\n    FlowCirclesLayer.prototype.getShaders = function () {\n        return _super.prototype.getShaders.call(this, {\n            vs: VertexShader,\n            fs: FragmentShader,\n            modules: [project32, picking],\n        });\n    };\n    FlowCirclesLayer.prototype.initializeState = function () {\n        this.getAttributeManager().addInstanced({\n            instancePositions: {\n                size: 3,\n                type: DOUBLE,\n                fp64: this.use64bitPositions(),\n                transition: true,\n                accessor: 'getPosition',\n            },\n            instanceRadius: {\n                size: 1,\n                transition: true,\n                accessor: 'getRadius',\n                defaultValue: 1,\n            },\n            instanceColors: {\n                size: 4,\n                transition: true,\n                type: UNSIGNED_BYTE,\n                accessor: 'getColor',\n                defaultValue: DEFAULT_COLOR,\n            },\n        });\n    };\n    FlowCirclesLayer.prototype.updateState = function (_a) {\n        var props = _a.props, oldProps = _a.oldProps, changeFlags = _a.changeFlags;\n        _super.prototype.updateState.call(this, { props: props, oldProps: oldProps, changeFlags: changeFlags });\n        if (changeFlags.extensionsChanged) {\n            var gl = this.context.gl;\n            if (this.state.model) {\n                this.state.model.delete();\n            }\n            this.setState({ model: this._getModel(gl) });\n            this.getAttributeManager().invalidateAll();\n        }\n    };\n    FlowCirclesLayer.prototype.draw = function (_a) {\n        var uniforms = _a.uniforms;\n        this.state.model.setUniforms(uniforms).draw();\n    };\n    FlowCirclesLayer.prototype._getModel = function (gl) {\n        // a square that minimally cover the unit circle\n        var positions = [-1, -1, 0, -1, 1, 0, 1, 1, 0, 1, -1, 0];\n        return new Model(gl, Object.assign(this.getShaders(), {\n            id: this.props.id,\n            geometry: new Geometry({\n                drawMode: TRIANGLE_FAN,\n                vertexCount: 4,\n                attributes: {\n                    positions: { size: 3, value: new Float32Array(positions) },\n                },\n            }),\n            isInstanced: true,\n        }));\n    };\n    FlowCirclesLayer.layerName = 'FlowCirclesLayer';\n    FlowCirclesLayer.defaultProps = {\n        getColor: { type: 'accessor', value: DEFAULT_COLOR },\n        getPosition: { type: 'accessor', value: function (d) { return d.position; } },\n        getRadius: { type: 'accessor', value: 1 },\n        parameters: {\n            depthTest: false,\n        },\n    };\n    return FlowCirclesLayer;\n}(Layer));\nexport default FlowCirclesLayer;\n//# sourceMappingURL=FlowCirclesLayer.js.map","// Copyright (c) 2015 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nexport default \"#define SHADER_NAME flow-circles-layer-vertex-shader\\n#define radiusScale 100\\n\\nattribute vec3 positions;\\n\\nattribute vec3 instancePositions;\\nattribute vec3 instancePositions64Low;\\nattribute float instanceRadius;\\nattribute vec4 instanceColors;\\nattribute vec3 instancePickingColors;\\n\\nuniform float opacity;\\nvarying vec4 vColor;\\nvarying vec2 unitPosition;\\nvarying float outerRadiusPixels;\\n\\nvoid main(void) {\\n  geometry.worldPosition = instancePositions;\\n\\n  outerRadiusPixels = instanceRadius;  \\n\\n  // position on the containing square in [-1, 1] space\\n  unitPosition = positions.xy;\\n  geometry.uv = unitPosition;\\n  geometry.pickingColor = instancePickingColors;\\n                                                                                                    \\n  // Find the center of the point and add the current vertex\\n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\\n  DECKGL_FILTER_SIZE(offset, geometry);\\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\\n                            \\n  // Apply opacity to instance color, or return instance picking color\\n  vColor = vec4(instanceColors.rgb / 255., instanceColors.a / 255. * opacity);\\n  DECKGL_FILTER_COLOR(vColor, geometry);\\n}\\n\";\n//# sourceMappingURL=FlowCirclesLayerVertex.glsl.js.map","/*\n * Copyright 2019 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nexport default \"#define SHADER_NAME flow-circles-layer-fragment-shader\\n#define SOFT_OUTLINE 0.1\\nprecision highp float;\\n\\nvarying vec4 vColor;\\nvarying vec2 unitPosition;\\nvarying float outerRadiusPixels;\\n\\nvoid main(void) {\\n  geometry.uv = unitPosition;\\n  float distToCenter = length(unitPosition);\\n  if (distToCenter > 1.0) {\\n    discard;\\n  }\\n  gl_FragColor = vColor;\\n  gl_FragColor.a *= smoothstep(0.0, SOFT_OUTLINE, 1.0 - distToCenter);\\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\\n}\\n\";\n//# sourceMappingURL=FlowCirclesLayerFragment.glsl.js.map","/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { Layer, picking, project32 } from '@deck.gl/core';\nimport { TRIANGLES, UNSIGNED_BYTE, DOUBLE } from '@luma.gl/constants';\nimport { Geometry, Model } from '@luma.gl/core';\nimport FragmentShader from './FlowLinesLayerFragment.glsl';\nimport VertexShader from './FlowLinesLayerVertex.glsl';\nvar DEFAULT_COLOR = [0, 132, 193, 255];\nvar INNER_SIDE_OUTLINE_THICKNESS = 1;\nvar FlowLinesLayer = /** @class */ (function (_super) {\n    __extends(FlowLinesLayer, _super);\n    function FlowLinesLayer(props) {\n        return _super.call(this, props) || this;\n    }\n    FlowLinesLayer.prototype.getShaders = function () {\n        return _super.prototype.getShaders.call(this, {\n            vs: VertexShader,\n            fs: FragmentShader,\n            modules: [project32, picking],\n            shaderCache: this.context.shaderCache,\n        });\n    };\n    FlowLinesLayer.prototype.initializeState = function () {\n        var attributeManager = this.state.attributeManager;\n        attributeManager.addInstanced({\n            instanceSourcePositions: {\n                accessor: 'getSourcePosition',\n                size: 3,\n                transition: false,\n                type: DOUBLE,\n            },\n            instanceTargetPositions: {\n                accessor: 'getTargetPosition',\n                size: 3,\n                transition: false,\n                type: DOUBLE,\n            },\n            instanceThickness: {\n                accessor: 'getThickness',\n                size: 1,\n                transition: false,\n            },\n            instanceEndpointOffsets: {\n                accessor: 'getEndpointOffsets',\n                size: 2,\n                transition: false,\n            },\n            instanceColors: {\n                accessor: 'getColor',\n                size: 4,\n                type: UNSIGNED_BYTE,\n                transition: false,\n            },\n            instancePickable: {\n                accessor: 'getPickable',\n                size: 1,\n                transition: false,\n            },\n        });\n    };\n    FlowLinesLayer.prototype.updateState = function (_a) {\n        var props = _a.props, oldProps = _a.oldProps, changeFlags = _a.changeFlags;\n        _super.prototype.updateState.call(this, { props: props, oldProps: oldProps, changeFlags: changeFlags });\n        if (changeFlags.extensionsChanged) {\n            var gl = this.context.gl;\n            if (this.state.model) {\n                this.state.model.delete();\n            }\n            this.setState({ model: this._getModel(gl) });\n            this.getAttributeManager().invalidateAll();\n        }\n    };\n    FlowLinesLayer.prototype.draw = function (_a) {\n        var uniforms = _a.uniforms;\n        var gl = this.context.gl;\n        var _b = this.props, outlineColor = _b.outlineColor, thicknessUnit = _b.thicknessUnit;\n        gl.lineWidth(1);\n        this.state.model\n            .setUniforms(__assign(__assign({}, uniforms), { outlineColor: outlineColor.map(function (x) { return x / 255; }), thicknessUnit: thicknessUnit * 2.0, gap: 0.5 }))\n            .draw();\n    };\n    FlowLinesLayer.prototype._getModel = function (gl) {\n        var positions = [];\n        var pixelOffsets = [];\n        var _a = this.props, drawOutline = _a.drawOutline, outlineThickness = _a.outlineThickness;\n        if (drawOutline) {\n            // source_target_mix, perpendicular_offset_in_thickness_units, direction_of_travel_offset_in_thickness_units\n            // prettier-ignore\n            positions = positions.concat([\n                // Outline\n                0, 0, 0,\n                0, 1, 0,\n                1, 0, 0,\n                0, 1, 0,\n                1, 0, -3,\n                1, 1, -3,\n                1, 0, 0,\n                1, 2, -3,\n                1, 0, -3,\n            ]);\n            var tout = outlineThickness;\n            var tin = INNER_SIDE_OUTLINE_THICKNESS; // the outline shouldn't cover the opposite arrow\n            // perpendicular_offset_in_pixels, direction_of_travel_offset_in_pixels, fill_outline_color_mix\n            // prettier-ignore\n            pixelOffsets = pixelOffsets.concat([\n                // Outline\n                -tin, -tout, 1,\n                tout, -tout, 1,\n                -tin, tout, 1,\n                tout, -tout, 1,\n                -tin, 0, 1,\n                tout, 0, 1,\n                -tin, 3 * tout, 1,\n                2 * tout, -tout, 1,\n                -tin, -tout, 1,\n            ]);\n        }\n        // prettier-ignore\n        positions = positions.concat([\n            // Fill\n            0, 0, 0,\n            0, 1, 0,\n            1, 0, 0,\n            0, 1, 0,\n            1, 0, -3,\n            1, 1, -3,\n            1, 0, 0,\n            1, 2, -3,\n            1, 0, -3,\n        ]);\n        // prettier-ignore\n        pixelOffsets = pixelOffsets.concat([\n            // Fill\n            0, 0, 0,\n            0, 0, 0,\n            0, 0, 0,\n            0, 0, 0,\n            0, 0, 0,\n            0, 0, 0,\n            0, 0, 0,\n            0, 0, 0,\n            0, 0, 0,\n        ]);\n        return new Model(gl, __assign(__assign({ id: this.props.id }, this.getShaders()), { geometry: new Geometry({\n                drawType: TRIANGLES,\n                attributes: {\n                    positions: new Float32Array(positions),\n                    normals: new Float32Array(pixelOffsets),\n                },\n            }), isInstanced: true, shaderCache: this.context.shaderCache }));\n    };\n    FlowLinesLayer.layerName = 'FlowLinesLayer';\n    FlowLinesLayer.defaultProps = {\n        getSourcePosition: { type: 'accessor', value: function (d) { return d.sourcePosition; } },\n        getTargetPosition: { type: 'accessor', value: function (d) { return d.targetPosition; } },\n        getColor: { type: 'accessor', value: DEFAULT_COLOR },\n        getThickness: { type: 'accessor', value: function (d) { return d.thickness; } },\n        getPickable: { type: 'accessor', value: function (d) { return 1.0; } },\n        drawOutline: true,\n        thicknessUnit: 10,\n        outlineThickness: 1,\n        outlineColor: [255, 255, 255, 255],\n        parameters: {\n            depthTest: false,\n        },\n    };\n    return FlowLinesLayer;\n}(Layer));\nexport default FlowLinesLayer;\n//# sourceMappingURL=FlowLinesLayer.js.map","/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/*\n * This file was modified by Teralytics. Originally licenced under:\n *\n * Copyright (c) 2016 Uber Technologies, Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nexport default \"#define SHADER_NAME flow-line-layer-vertex-shader\\n\\nattribute vec3 positions;\\nattribute vec3 normals;\\nattribute vec4 instanceColors;\\nattribute float instanceThickness;    // 0..0.5\\nattribute vec3 instanceSourcePositions;\\nattribute vec3 instanceTargetPositions;\\nattribute vec3 instanceSourcePositions64Low;\\nattribute vec3 instanceTargetPositions64Low;\\nattribute vec3 instancePickingColors;\\nattribute vec2 instanceEndpointOffsets;\\nattribute float instancePickable;\\n\\nuniform vec4 outlineColor;\\nuniform float thicknessUnit;\\nuniform float gap;\\nuniform float opacity;\\n\\nvarying vec4 vColor;\\nvarying vec2 uv;\\n\\nvoid main(void) {\\n  geometry.worldPosition = instanceSourcePositions;\\n  geometry.worldPositionAlt = instanceTargetPositions;\\n  \\n  // Position\\n  vec4 source_commonspace;    \\n  vec4 target_commonspace;\\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourcePositions64Low, vec3(0.), source_commonspace);\\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceTargetPositions64Low, vec3(0.), target_commonspace);\\n\\n  // linear interpolation of source & target to pick right coord\\n  float sourceOrTarget = positions.x;\\n  geometry.position = mix(source_commonspace, target_commonspace, sourceOrTarget);\\n  uv = positions.xy;\\n  geometry.uv = uv;\\n  if (instancePickable > 0.5) {\\n    geometry.pickingColor = instancePickingColors;\\n  }\\n  \\n  // set the clamp limits in pixel size \\n  float lengthCommon = length(target_commonspace - source_commonspace);    \\n  vec2 offsetDistances = project_pixel_size(positions.yz) * thicknessUnit;\\n  \\n  vec2 limitedOffsetDistances = clamp(   \\n    project_pixel_size(positions.yz) * thicknessUnit,\\n    -lengthCommon*.8, lengthCommon*.8\\n  );\\n  float startOffsetCommon = project_pixel_size(instanceEndpointOffsets[0]);\\n  float endOffsetCommon = project_pixel_size(instanceEndpointOffsets[1]);\\n  float endpointOffset = mix(\\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\\n    positions.x\\n  );\\n\\n  vec2 flowlineDir = normalize(target_commonspace.xy - source_commonspace.xy);\\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\\n  vec2 normalsCommon = project_pixel_size(normals.xy);\\n  float gapCommon = project_pixel_size(gap);\\n  vec3 offsetCommon = vec3(\\n    flowlineDir * (instanceThickness * limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\\n    perpendicularDir * (instanceThickness * limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\\n    0.0\\n  );\\n  \\n  DECKGL_FILTER_SIZE(offsetCommon, geometry);\\n  vec4 position_commonspace = mix(source_commonspace, target_commonspace, sourceOrTarget);\\n  vec4 offset_commonspace = vec4(offsetCommon, 0.0);\\n  gl_Position = project_common_position_to_clipspace(position_commonspace + offset_commonspace);\\n      \\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\\n  \\n  vec4 fillColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\\n  if (instancePickable <= 0.5) {\\n    vColor = mix(fillColor, vec4(outlineColor.xyz, instanceThickness), normals.z);\\n  } else {\\n    vColor = mix(fillColor, vec4(outlineColor.xyz, outlineColor.w * fillColor.w), normals.z);\\n  }\\n  DECKGL_FILTER_COLOR(vColor, geometry);\\n}\\n\";\n//# sourceMappingURL=FlowLinesLayerVertex.glsl.js.map","/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/*\n * This file was modified by Teralytics. Originally licenced under:\n *\n * Copyright (c) 2015 Uber Technologies, Inc.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n */\nexport default \"#define SHADER_NAME flow-line-layer-fragment-shader\\n\\nprecision highp float;\\n\\nvarying vec4 vColor;\\nvarying vec2 uv;\\n\\nvoid main(void) {\\n  if (vColor.a == 0.0) {\\n    discard;\\n  }\\n\\n  geometry.uv = uv;\\n  gl_FragColor = vColor;\\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\\n}\\n\";\n//# sourceMappingURL=FlowLinesLayerFragment.glsl.js.map","/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { color as d3color, hcl } from 'd3-color';\nimport { interpolateRgbBasis } from 'd3-interpolate';\n// @ts-ignore\nimport { scaleSequentialPow } from 'd3-scale';\nvar DEFAULT_FLOW_MIN_COLOR = 'rgba(240,240,240,0.5)';\nvar DEFAULT_FLOW_COLOR_SCHEME = [DEFAULT_FLOW_MIN_COLOR, '#137CBD'];\nvar DEFAULT_FLOW_COLOR_SCHEME_POSITIVE = [DEFAULT_FLOW_MIN_COLOR, '#f6654e'];\nvar DEFAULT_FLOW_COLOR_SCHEME_NEGATIVE = [DEFAULT_FLOW_MIN_COLOR, '#00a9cc'];\nvar DEFAULT_OUTLINE_COLOR = '#fff';\nvar DEFAULT_LOCATION_AREA_COLOR = 'rgba(220,220,220,0.5)';\nvar DEFAULT_DIMMED_OPACITY = 0.4;\nvar CIRCLE_DIMMED_OPACITY_MULTIPLIER = 0.5;\nvar FALLBACK_COLOR_RGBA = [255, 255, 255, 255];\nexport function isDiffColors(colors) {\n    return colors.positive !== undefined;\n}\nexport function isDiffColorsRGBA(colors) {\n    return colors.positive !== undefined;\n}\nfunction getBaseColorsRGBA(colors) {\n    var darkMode = colors && colors.darkMode ? true : false;\n    return {\n        darkMode: darkMode,\n        locationAreas: getLocationAreaColorsRGBA(colors && colors.locationAreas, darkMode),\n        outlineColor: colorAsRgba((colors && colors.outlineColor) || DEFAULT_OUTLINE_COLOR),\n        dimmedOpacity: colors && colors.dimmedOpacity != null ? colors.dimmedOpacity : DEFAULT_DIMMED_OPACITY,\n    };\n}\nexport function getColorsRGBA(colors) {\n    var baseColorsRGBA = getBaseColorsRGBA(colors);\n    return __assign(__assign({}, baseColorsRGBA), getFlowAndCircleColors(colors, DEFAULT_FLOW_COLOR_SCHEME, baseColorsRGBA.darkMode));\n}\nexport function getDiffColorsRGBA(colors) {\n    var baseColorsRGBA = getBaseColorsRGBA(colors);\n    return __assign(__assign({}, baseColorsRGBA), { positive: getFlowAndCircleColors(colors && colors.positive, DEFAULT_FLOW_COLOR_SCHEME_POSITIVE, baseColorsRGBA.darkMode), negative: getFlowAndCircleColors(colors && colors.negative, DEFAULT_FLOW_COLOR_SCHEME_NEGATIVE, baseColorsRGBA.darkMode) });\n}\nfunction getLocationAreaColorsRGBA(colors, darkMode) {\n    var normalColor = (colors && colors.normal) || DEFAULT_LOCATION_AREA_COLOR;\n    var normalColorHcl = hcl(normalColor);\n    var locationAreasNormal = colorAsRgba(normalColor);\n    return {\n        normal: locationAreasNormal,\n        connected: colorAsRgbaOr(colors && colors.connected, locationAreasNormal),\n        highlighted: colorAsRgbaOr(colors && colors.highlighted, opacifyHex(normalColorHcl[darkMode ? 'brighter' : 'darker'](1).toString(), 0.5)),\n        selected: colorAsRgbaOr(colors && colors.selected, opacifyHex(normalColorHcl[darkMode ? 'brighter' : 'darker'](2).toString(), 0.8)),\n        outline: colorAsRgbaOr(colors && colors.outline, colorAsRgba(normalColorHcl[darkMode ? 'brighter' : 'darker'](4).toString())),\n    };\n}\nfunction getFlowAndCircleColors(inputColors, defaultFlowColorScheme, darkMode) {\n    var flowColorScheme = (inputColors && inputColors.flows && inputColors.flows.scheme) || defaultFlowColorScheme;\n    var maxFlowColorHcl = hcl(flowColorScheme[flowColorScheme.length - 1]);\n    var flowColorHighlighted = colorAsRgbaOr(inputColors && inputColors.flows && inputColors.flows.highlighted, colorAsRgba(maxFlowColorHcl[darkMode ? 'brighter' : 'darker'](0.7).toString()));\n    return {\n        flows: {\n            scheme: flowColorScheme,\n            highlighted: flowColorHighlighted,\n        },\n        locationCircles: {\n            inner: colorAsRgbaOr(inputColors && inputColors.locationCircles && inputColors.locationCircles.inner, maxFlowColorHcl.toString()),\n            outgoing: colorAsRgbaOr(inputColors && inputColors.locationCircles && inputColors.locationCircles.outgoing, darkMode ? '#000' : '#fff'),\n            incoming: colorAsRgbaOr(inputColors && inputColors.locationCircles && inputColors.locationCircles.incoming, maxFlowColorHcl[darkMode ? 'brighter' : 'darker'](1.25).toString()),\n            highlighted: colorAsRgbaOr(inputColors && inputColors.locationCircles && inputColors.locationCircles.highlighted, flowColorHighlighted),\n        },\n    };\n}\nexport function colorAsRgba(color) {\n    var col = d3color(color);\n    if (!col) {\n        console.warn('Invalid color: ', color);\n        return FALLBACK_COLOR_RGBA;\n    }\n    var rgbColor = col.rgb();\n    return [Math.floor(rgbColor.r), Math.floor(rgbColor.g), Math.floor(rgbColor.b), opacityFloatToInteger(col.opacity)];\n}\nfunction colorAsRgbaOr(color, defaultColor) {\n    if (color) {\n        return colorAsRgba(color);\n    }\n    if (typeof defaultColor === 'string') {\n        return colorAsRgba(defaultColor);\n    }\n    return defaultColor;\n}\nexport function rgbaAsString(color) {\n    return \"rgba(\" + color.join(',') + \")\";\n}\nexport function opacifyHex(hexCode, opacity) {\n    var c = d3color(hexCode);\n    if (!c) {\n        console.warn('Invalid color: ', hexCode);\n        return \"rgba(255, 255, 255, \" + opacity + \")\";\n    }\n    var col = c.rgb();\n    return \"rgba(\" + col.r + \", \" + col.g + \", \" + col.b + \", \" + opacity + \")\";\n}\nexport function opacityFloatToInteger(opacity) {\n    return Math.round(opacity * 255);\n}\nexport function getDimmedCircleOutlineColor(outlineColor, opacity) {\n    var r = outlineColor[0], g = outlineColor[1], b = outlineColor[2], a = outlineColor[3];\n    return [r, g, b, a * opacity * CIRCLE_DIMMED_OPACITY_MULTIPLIER];\n}\nexport function getDimmedCircleColor(color, opacity) {\n    return getDimmedColor(color, opacity * CIRCLE_DIMMED_OPACITY_MULTIPLIER);\n}\nexport function getDimmedColor(color, opacity) {\n    var col = hcl(rgbaAsString(color));\n    if (!col) {\n        console.warn('Invalid color: ', color);\n        return FALLBACK_COLOR_RGBA;\n    }\n    col.c *= 0.1; // desaturate color\n    var rgbColor = col.rgb();\n    return [\n        Math.floor(rgbColor.r),\n        Math.floor(rgbColor.g),\n        Math.floor(rgbColor.b),\n        opacityFloatToInteger(opacity !== undefined ? opacity : DEFAULT_DIMMED_OPACITY),\n    ];\n}\nexport function createFlowColorScale(domain, scheme, animate) {\n    var scale = scaleSequentialPow(interpolateRgbBasis(scheme))\n        .exponent(animate ? 1 / 2 : 1 / 3)\n        .domain(domain);\n    return function (value) { return colorAsRgba(scale(value)); };\n}\n//# sourceMappingURL=colors.js.map","// tslint:disable:member-ordering\nimport { ascending, extent, max } from 'd3-array';\nimport { nest } from 'd3-collection';\nimport { scaleLinear, scalePow } from 'd3-scale';\nimport { createSelector } from 'reselect';\nimport { colorAsRgba, createFlowColorScale, getColorsRGBA, getDiffColorsRGBA, getDimmedCircleColor, getDimmedCircleOutlineColor, getDimmedColor, isDiffColorsRGBA, } from './colors';\nimport FlowMapLayer from './FlowMapLayer';\nimport { isFeatureCollection, } from './types';\nvar CIRCLE_OUTLINE_THICKNESS = 1;\nvar getDiffMode = function (props) { return props.diffMode; };\nvar getColorsProp = function (props) { return props.colors; };\nvar getAnimate = function (props) { return props.animate; };\nvar getLocationFeatures = function (props) {\n    return isFeatureCollection(props.locations) ? props.locations.features : props.locations;\n};\nvar getFlows = function (props) { return props.flows; };\nvar getHighlightedFlow = function (props) { return props.highlightedFlow; };\nvar getHighlightedLocationId = function (props) { return props.highlightedLocationId; };\nvar getSelectedLocationIds = function (props) { return props.selectedLocationIds; };\nvar getShowOnlyTopFlows = function (props) { return props.showOnlyTopFlows; };\nvar getMaxLocationCircleSize = function (props) {\n    return props.maxLocationCircleSize != null ? props.maxLocationCircleSize : FlowMapLayer.defaultProps.maxLocationCircleSize;\n};\nvar Selectors = /** @class */ (function () {\n    function Selectors(inputAccessors) {\n        var _this = this;\n        this.inputAccessors = inputAccessors;\n        this.getColors = createSelector([getColorsProp, getDiffMode], function (colors, diffMode) {\n            if (diffMode) {\n                return getDiffColorsRGBA(colors);\n            }\n            return getColorsRGBA(colors);\n        });\n        this.getLocationByIdGetter = createSelector([getLocationFeatures], function (locations) {\n            var locationsById = nest()\n                .key(_this.inputAccessors.getLocationId)\n                .rollup(function (_a) {\n                var d = _a[0];\n                return d;\n            })\n                .object(locations);\n            return function (id) {\n                var location = locationsById[id];\n                if (!location) {\n                    console.warn(\"No location found for id '\" + id + \"'\");\n                }\n                return location;\n            };\n        });\n        this.getFilteredFlows = createSelector([getFlows, getSelectedLocationIds], function (flows, selectedLocationIds) {\n            var _a = _this.inputAccessors, getFlowOriginId = _a.getFlowOriginId, getFlowDestId = _a.getFlowDestId;\n            if (selectedLocationIds) {\n                return flows.filter(function (flow) {\n                    return selectedLocationIds.indexOf(getFlowOriginId(flow)) >= 0 ||\n                        selectedLocationIds.indexOf(getFlowDestId(flow)) >= 0;\n                });\n            }\n            return flows;\n        });\n        this.getNonSelfFlows = createSelector([this.getFilteredFlows], function (flows) {\n            var _a = _this.inputAccessors, getFlowOriginId = _a.getFlowOriginId, getFlowDestId = _a.getFlowDestId;\n            return flows.filter(function (flow) { return getFlowOriginId(flow) !== getFlowDestId(flow); });\n        });\n        this.getSortedNonSelfFlows = createSelector([this.getNonSelfFlows], function (flows) {\n            var comparator = function (f1, f2) {\n                return Math.abs(_this.inputAccessors.getFlowMagnitude(f1)) - Math.abs(_this.inputAccessors.getFlowMagnitude(f2));\n            };\n            return flows.slice().sort(comparator);\n        });\n        this.getTopFlows = createSelector([this.getSortedNonSelfFlows, getShowOnlyTopFlows], function (flows, showOnlyTopFlows) {\n            if (showOnlyTopFlows != null && showOnlyTopFlows > 0 && flows.length > showOnlyTopFlows) {\n                return flows.slice(flows.length - showOnlyTopFlows, flows.length);\n            }\n            return flows;\n        });\n        this.getHighlightedFlows = createSelector([this.getSortedNonSelfFlows, getHighlightedFlow, getHighlightedLocationId], function (flows, highlightedFlow, highlightedLocationId) {\n            var _a = _this.inputAccessors, getFlowOriginId = _a.getFlowOriginId, getFlowDestId = _a.getFlowDestId;\n            if (highlightedFlow) {\n                return [highlightedFlow];\n            }\n            if (highlightedLocationId) {\n                return flows.filter(function (flow) { return getFlowOriginId(flow) === highlightedLocationId || getFlowDestId(flow) === highlightedLocationId; });\n            }\n            return undefined;\n        });\n        this.getFlowMagnitudeExtent = createSelector([this.getNonSelfFlows], function (flows) { return extent(flows, function (f) { return _this.inputAccessors.getFlowMagnitude(f); }); });\n        this.getFlowThicknessScale = createSelector([this.getFlowMagnitudeExtent], function (_a) {\n            var minMagnitude = _a[0], maxMagnitude = _a[1];\n            var scale = scaleLinear()\n                .range([0.05, 0.5])\n                .domain([0, Math.max(Math.abs(minMagnitude || 0), Math.abs(maxMagnitude || 0))]);\n            return function (magnitude) { return scale(Math.abs(magnitude)); };\n        });\n        this.getFlowColorScale = createSelector([this.getColors, this.getFlowMagnitudeExtent, getAnimate], function (colors, _a, animate) {\n            var minMagnitude = _a[0], maxMagnitude = _a[1];\n            if (isDiffColorsRGBA(colors)) {\n                var posScale_1 = createFlowColorScale([0, maxMagnitude || 0], colors.positive.flows.scheme, animate);\n                var negScale_1 = createFlowColorScale([0, minMagnitude || 0], colors.negative.flows.scheme, animate);\n                return function (magnitude) { return (magnitude >= 0 ? posScale_1(magnitude) : negScale_1(magnitude)); };\n            }\n            var scale = createFlowColorScale([0, maxMagnitude || 0], colors.flows.scheme, animate);\n            return function (magnitude) { return scale(magnitude); };\n        });\n        this.getLocationTotals = createSelector([getLocationFeatures, this.getFilteredFlows], function (locations, flows) {\n            var _a = _this.inputAccessors, getFlowOriginId = _a.getFlowOriginId, getFlowDestId = _a.getFlowDestId, getFlowMagnitude = _a.getFlowMagnitude;\n            return flows.reduce(function (acc, curr) {\n                var originId = getFlowOriginId(curr);\n                var destId = getFlowDestId(curr);\n                var magnitude = getFlowMagnitude(curr);\n                if (originId === destId) {\n                    acc.within[originId] = (acc.within[originId] || 0) + magnitude;\n                }\n                else {\n                    acc.outgoing[originId] = (acc.outgoing[originId] || 0) + magnitude;\n                    acc.incoming[destId] = (acc.incoming[destId] || 0) + magnitude;\n                }\n                return acc;\n            }, { incoming: {}, outgoing: {}, within: {} });\n        });\n        this.getHighlightedLocationCircles = createSelector([this.getLocationByIdGetter, getHighlightedLocationId], function (getLocationById, highlightedLocationId) {\n            if (highlightedLocationId) {\n                var location_1 = getLocationById(highlightedLocationId);\n                if (!location_1) {\n                    return undefined;\n                }\n                return [\n                    { location: location_1, type: \"outline\" /* OUTLINE */ },\n                    { location: location_1, type: \"outer\" /* OUTER */ },\n                    { location: location_1, type: \"inner\" /* INNER */ },\n                ];\n            }\n            return undefined;\n        });\n        this.getLocationTotalInGetter = function (props) {\n            var _a = _this.inputAccessors, getLocationTotalIn = _a.getLocationTotalIn, getLocationId = _a.getLocationId;\n            if (getLocationTotalIn) {\n                return getLocationTotalIn;\n            }\n            var incoming = _this.getLocationTotals(props).incoming;\n            return function (location) { return incoming[getLocationId(location)] || 0; };\n        };\n        this.getLocationTotalOutGetter = function (props) {\n            var _a = _this.inputAccessors, getLocationTotalOut = _a.getLocationTotalOut, getLocationId = _a.getLocationId;\n            if (getLocationTotalOut) {\n                return getLocationTotalOut;\n            }\n            var outgoing = _this.getLocationTotals(props).outgoing;\n            return function (location) { return outgoing[getLocationId(location)] || 0; };\n        };\n        this.getLocationTotalWithinGetter = function (props) {\n            var _a = _this.inputAccessors, getLocationTotalWithin = _a.getLocationTotalWithin, getLocationId = _a.getLocationId;\n            if (getLocationTotalWithin) {\n                return getLocationTotalWithin;\n            }\n            var within = _this.getLocationTotals(props).within;\n            return function (location) { return within[getLocationId(location)] || 0; };\n        };\n        this.getLocationMaxAbsTotalGetter = createSelector([\n            getLocationFeatures,\n            this.getLocationTotalInGetter,\n            this.getLocationTotalOutGetter,\n            this.getLocationTotalWithinGetter,\n        ], function (locations, getLocationTotalIn, getLocationTotalOut, getLocationTotalWithin) {\n            return function (location) {\n                return Math.max(Math.abs(getLocationTotalIn(location) + getLocationTotalWithin(location)), Math.abs(getLocationTotalOut(location) + getLocationTotalWithin(location)));\n            };\n        });\n        this.getMaxLocationMaxAbsTotal = createSelector([getLocationFeatures, this.getLocationMaxAbsTotalGetter], function (locations, getLocationMaxAbsTotal) { return max(locations, getLocationMaxAbsTotal) || 0; });\n        this.getLocationCircles = createSelector([getLocationFeatures, this.getLocationMaxAbsTotalGetter], function (locations, getLocationMaxAbsTotalGetter) {\n            var circles = [];\n            var sorted = locations\n                .slice()\n                .sort(function (a, b) { return ascending(getLocationMaxAbsTotalGetter(a), getLocationMaxAbsTotalGetter(b)); });\n            for (var _i = 0, sorted_1 = sorted; _i < sorted_1.length; _i++) {\n                var location_2 = sorted_1[_i];\n                circles.push({\n                    location: location_2,\n                    type: \"outline\" /* OUTLINE */,\n                });\n                circles.push({\n                    location: location_2,\n                    type: \"outer\" /* OUTER */,\n                });\n                circles.push({\n                    location: location_2,\n                    type: \"inner\" /* INNER */,\n                });\n            }\n            return circles;\n        });\n        this.getSizeScale = createSelector([getMaxLocationCircleSize, this.getMaxLocationMaxAbsTotal], function (maxLocationCircleSize, maxTotal) {\n            var scale = scalePow()\n                .exponent(1 / 2)\n                .domain([0, maxTotal])\n                .range([0, maxTotal > 0 ? maxLocationCircleSize : 1]);\n            return function (v) { return scale(Math.abs(v)); };\n        });\n        this.getLocationCircleRadiusGetter = createSelector([\n            this.getSizeScale,\n            this.getLocationTotalInGetter,\n            this.getLocationTotalOutGetter,\n            this.getLocationTotalWithinGetter,\n        ], function (sizeScale, getLocationTotalIn, getLocationTotalOut, getLocationTotalWithin) {\n            return function (_a) {\n                var location = _a.location, type = _a.type;\n                var getSide = type === \"inner\" /* INNER */ ? Math.min : Math.max;\n                var totalIn = getLocationTotalIn(location);\n                var totalOut = getLocationTotalOut(location);\n                var totalWithin = getLocationTotalWithin(location);\n                var r = sizeScale(getSide(Math.abs(totalIn + totalWithin), Math.abs(totalOut + totalWithin)));\n                if (type === \"outline\" /* OUTLINE */) {\n                    return r + CIRCLE_OUTLINE_THICKNESS;\n                }\n                return r;\n            };\n        });\n        this.getLocationCircleColorGetter = createSelector([\n            this.getColors,\n            getHighlightedLocationId,\n            this.getLocationTotalInGetter,\n            this.getLocationTotalOutGetter,\n            this.getLocationTotalWithinGetter,\n        ], function (colors, highlightedLocationId, getLocationTotalIn, getLocationTotalOut, getLocationTotalWithin) {\n            var getLocationId = _this.inputAccessors.getLocationId;\n            return function (_a) {\n                var location = _a.location, type = _a.type;\n                var isHighlighted = highlightedLocationId && highlightedLocationId === getLocationId(location);\n                var isDimmed = highlightedLocationId && highlightedLocationId !== getLocationId(location);\n                var totalWithin = getLocationTotalWithin(location);\n                var totalIn = getLocationTotalIn(location) + totalWithin;\n                var totalOut = getLocationTotalOut(location) + totalWithin;\n                var isIncoming = type === \"outer\" /* OUTER */ && Math.abs(totalIn) > Math.abs(totalOut);\n                var isPositive = (isIncoming === true && totalIn >= 0) || totalOut >= 0;\n                var circleColors = (isDiffColorsRGBA(colors) ? (isPositive ? colors.positive : colors.negative) : colors)\n                    .locationCircles;\n                if (isHighlighted && type === \"outline\" /* OUTLINE */) {\n                    return circleColors.highlighted;\n                }\n                if (isDimmed) {\n                    if (type === \"outline\" /* OUTLINE */) {\n                        return getDimmedCircleOutlineColor(colors.outlineColor, colors.dimmedOpacity);\n                    }\n                    return getDimmedCircleColor(circleColors.inner, colors.dimmedOpacity);\n                }\n                if (type === \"outline\" /* OUTLINE */) {\n                    return isIncoming ? circleColors.incoming : circleColors.inner;\n                }\n                if (type === \"inner\" /* INNER */) {\n                    return circleColors.inner;\n                }\n                if (isIncoming === true) {\n                    return circleColors.incoming;\n                }\n                return circleColors.outgoing;\n            };\n        });\n        this.isLocationConnectedGetter = createSelector([this.getFilteredFlows, getHighlightedLocationId, getHighlightedFlow, getSelectedLocationIds], function (flows, highlightedLocationId, highlightedFlow, selectedLocationIds) {\n            var _a = _this.inputAccessors, getFlowOriginId = _a.getFlowOriginId, getFlowDestId = _a.getFlowDestId;\n            if (highlightedLocationId) {\n                var isRelated = function (flow) {\n                    var originId = getFlowOriginId(flow);\n                    var destId = getFlowDestId(flow);\n                    return (originId === highlightedLocationId ||\n                        (selectedLocationIds && selectedLocationIds.indexOf(originId) >= 0) ||\n                        destId === highlightedLocationId ||\n                        (selectedLocationIds && selectedLocationIds.indexOf(destId) >= 0));\n                };\n                var locations_1 = new Set();\n                for (var _i = 0, flows_1 = flows; _i < flows_1.length; _i++) {\n                    var flow = flows_1[_i];\n                    if (isRelated(flow)) {\n                        locations_1.add(getFlowOriginId(flow));\n                        locations_1.add(getFlowDestId(flow));\n                    }\n                }\n                return function (id) { return locations_1.has(id); };\n            }\n            return function () { return false; };\n        });\n        this.getLocationAreaFillColorGetter = createSelector([this.getColors, getSelectedLocationIds, this.isLocationConnectedGetter], function (colors, selectedLocationIds, isLocationConnected) {\n            return function (location) {\n                var locationId = _this.inputAccessors.getLocationId(location);\n                if (selectedLocationIds && selectedLocationIds.indexOf(locationId) >= 0) {\n                    return colors.locationAreas.selected;\n                }\n                if (isLocationConnected(locationId)) {\n                    return colors.locationAreas.connected;\n                }\n                return colors.locationAreas.normal;\n            };\n        });\n    }\n    Selectors.prototype.getFlowLinesColorGetter = function (colors, flowColorScale, highlighted, dimmed) {\n        var _a = this.inputAccessors, getFlowMagnitude = _a.getFlowMagnitude, getFlowColor = _a.getFlowColor;\n        return function (flow) {\n            if (getFlowColor) {\n                var color = getFlowColor(flow);\n                if (color) {\n                    return colorAsRgba(color);\n                }\n            }\n            if (highlighted) {\n                if (isDiffColorsRGBA(colors)) {\n                    var positiveColor = colors.positive.flows.highlighted;\n                    var negativeColor = colors.negative.flows.highlighted;\n                    var magnitude = getFlowMagnitude(flow);\n                    return magnitude >= 0 ? positiveColor : negativeColor;\n                }\n                else {\n                    return colors.flows.highlighted;\n                }\n            }\n            else {\n                var magnitude = getFlowMagnitude(flow);\n                var color = flowColorScale(magnitude);\n                if (dimmed) {\n                    return getDimmedColor(color, colors.dimmedOpacity);\n                }\n                return color;\n            }\n        };\n    };\n    Selectors.prototype.setInputAccessors = function (inputAccessors) {\n        this.inputAccessors = inputAccessors;\n    };\n    Selectors.prototype.getInputAccessors = function () {\n        return this.inputAccessors;\n    };\n    return Selectors;\n}());\nexport default Selectors;\n//# sourceMappingURL=Selectors.js.map","/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { CompositeLayer } from '@deck.gl/core';\nimport { GeoJsonLayer } from '@deck.gl/layers';\nimport AnimatedFlowLinesLayer from './AnimatedFlowLinesLayer/AnimatedFlowLinesLayer';\nimport FlowCirclesLayer from './FlowCirclesLayer/FlowCirclesLayer';\nimport FlowLinesLayer from './FlowLinesLayer/FlowLinesLayer';\nimport Selectors from './Selectors';\nimport { isFeatureCollection, PickingType, } from './types';\nvar LayerKind;\n(function (LayerKind) {\n    LayerKind[\"LOCATIONS\"] = \"LOCATIONS\";\n    LayerKind[\"LOCATION_AREAS\"] = \"LOCATION_AREAS\";\n    LayerKind[\"LOCATION_AREAS_OUTLINES\"] = \"LOCATION_AREAS_OUTLINES\";\n    LayerKind[\"LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED\"] = \"LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED\";\n    LayerKind[\"FLOWS\"] = \"FLOWS\";\n    LayerKind[\"LOCATIONS_HIGHLIGHTED\"] = \"LOCATIONS_HIGHLIGHTED\";\n    LayerKind[\"FLOWS_HIGHLIGHTED\"] = \"FLOWS_HIGHLIGHTED\";\n})(LayerKind || (LayerKind = {}));\nvar LAYER_ID_SEPARATOR = ':::';\nfunction getLayerId(baseLayerId, layerKind) {\n    return \"\" + baseLayerId + LAYER_ID_SEPARATOR + layerKind.valueOf();\n}\nfunction getLayerKind(id) {\n    var kind = id.substr(id.lastIndexOf(LAYER_ID_SEPARATOR) + LAYER_ID_SEPARATOR.length);\n    return LayerKind[kind];\n}\nfunction getPickType(_a) {\n    var id = _a.id;\n    switch (getLayerKind(id)) {\n        case LayerKind.FLOWS:\n        case LayerKind.FLOWS_HIGHLIGHTED:\n            return PickingType.FLOW;\n        case LayerKind.LOCATIONS:\n        case LayerKind.LOCATIONS_HIGHLIGHTED:\n            return PickingType.LOCATION;\n        case LayerKind.LOCATION_AREAS:\n            return PickingType.LOCATION_AREA;\n        default:\n            return undefined;\n    }\n}\nvar FlowMapLayer = /** @class */ (function (_super) {\n    __extends(FlowMapLayer, _super);\n    function FlowMapLayer(props) {\n        return _super.call(this, props) || this;\n    }\n    FlowMapLayer.prototype.initializeState = function () {\n        var _a = this.props, getLocationTotalIn = _a.getLocationTotalIn, getLocationTotalOut = _a.getLocationTotalOut, getLocationTotalWithin = _a.getLocationTotalWithin, getLocationId = _a.getLocationId, getLocationCentroid = _a.getLocationCentroid, getFlowOriginId = _a.getFlowOriginId, getFlowDestId = _a.getFlowDestId, getFlowMagnitude = _a.getFlowMagnitude, getFlowColor = _a.getFlowColor;\n        var selectors = new Selectors({\n            getLocationId: getLocationId,\n            getLocationCentroid: getLocationCentroid,\n            getLocationTotalIn: getLocationTotalIn,\n            getLocationTotalOut: getLocationTotalOut,\n            getLocationTotalWithin: getLocationTotalWithin,\n            getFlowOriginId: getFlowOriginId,\n            getFlowDestId: getFlowDestId,\n            getFlowMagnitude: getFlowMagnitude,\n            getFlowColor: getFlowColor,\n        });\n        this.setState({ selectors: selectors });\n    };\n    FlowMapLayer.prototype.updateState = function (params) {\n        _super.prototype.updateState.call(this, params);\n        var props = params.props, changeFlags = params.changeFlags;\n        if (changeFlags.propsChanged) {\n            var getLocationTotalIn = props.getLocationTotalIn, getLocationTotalOut = props.getLocationTotalOut, getLocationTotalWithin = props.getLocationTotalWithin, getLocationId = props.getLocationId, getLocationCentroid = props.getLocationCentroid, getFlowOriginId = props.getFlowOriginId, getFlowDestId = props.getFlowDestId, getFlowMagnitude = props.getFlowMagnitude, getFlowColor = props.getFlowColor;\n            this.state.selectors.setInputAccessors({\n                getLocationId: getLocationId,\n                getLocationCentroid: getLocationCentroid,\n                getLocationTotalIn: getLocationTotalIn,\n                getLocationTotalOut: getLocationTotalOut,\n                getLocationTotalWithin: getLocationTotalWithin,\n                getFlowOriginId: getFlowOriginId,\n                getFlowDestId: getFlowDestId,\n                getFlowMagnitude: getFlowMagnitude,\n                getFlowColor: getFlowColor,\n            });\n        }\n    };\n    FlowMapLayer.prototype.getPickingInfo = function (params) {\n        var type = getPickType(params.sourceLayer);\n        if (!type) {\n            return params.info;\n        }\n        var info = __assign(__assign({}, params.info), { type: type });\n        var selectors = this.state.selectors;\n        if (type === PickingType.FLOW) {\n            var getLocationById = selectors.getLocationByIdGetter(this.props);\n            var _a = selectors.getInputAccessors(), getFlowOriginId = _a.getFlowOriginId, getFlowDestId = _a.getFlowDestId;\n            var flow = info.object;\n            return __assign(__assign({}, info), (flow && {\n                origin: getLocationById(getFlowOriginId(flow)),\n                dest: getLocationById(getFlowDestId(flow)),\n            }));\n        }\n        if (type === PickingType.LOCATION || type === PickingType.LOCATION_AREA) {\n            var location_1 = type === PickingType.LOCATION ? info.object && info.object.location : info.object;\n            var getLocationTotalIn = selectors.getLocationTotalInGetter(this.props);\n            var getLocationTotalOut = selectors.getLocationTotalOutGetter(this.props);\n            var getLocationTotalWithin = selectors.getLocationTotalWithinGetter(this.props);\n            var getLocationCircleRadius = selectors.getLocationCircleRadiusGetter(this.props);\n            return __assign(__assign({}, info), (location_1 && {\n                object: location_1,\n                totalIn: getLocationTotalIn(location_1),\n                totalOut: getLocationTotalOut(location_1),\n                totalWithin: getLocationTotalWithin(location_1),\n                circleRadius: getLocationCircleRadius({ location: location_1, type: \"outer\" /* OUTER */ }),\n            }));\n        }\n        return info;\n    };\n    FlowMapLayer.prototype.renderLayers = function () {\n        var _a = this.props, showLocationAreas = _a.showLocationAreas, locations = _a.locations, highlightedLocationId = _a.highlightedLocationId;\n        var selectors = this.state.selectors;\n        var topFlows = selectors.getTopFlows(this.props);\n        var highlightedFlows = selectors.getHighlightedFlows(this.props);\n        var isLocationHighlighted = highlightedLocationId != null;\n        var locationCircles = selectors.getLocationCircles(this.props);\n        var layers = [];\n        if (showLocationAreas && isFeatureCollection(locations)) {\n            layers.push(this.getLocationAreasLayer(getLayerId(this.props.id, LayerKind.LOCATION_AREAS), false));\n        }\n        layers.push(this.getFlowLinesLayer(getLayerId(this.props.id, LayerKind.FLOWS), topFlows, false, isLocationHighlighted));\n        if (showLocationAreas && isFeatureCollection(locations)) {\n            layers.push(this.getHighlightedLocationAreasLayer(getLayerId(this.props.id, LayerKind.LOCATION_AREAS_SELECTED_AND_HIGHLIGHTED)));\n        }\n        if (highlightedFlows) {\n            layers.push(this.getFlowLinesLayer(getLayerId(this.props.id, LayerKind.FLOWS_HIGHLIGHTED), highlightedFlows, true, false));\n        }\n        layers.push(this.getLocationCirclesLayer(getLayerId(this.props.id, LayerKind.LOCATIONS), locationCircles, false));\n        if (isLocationHighlighted) {\n            var highlightedLocationCircles = selectors.getHighlightedLocationCircles(this.props);\n            layers.push(this.getLocationCirclesLayer(getLayerId(this.props.id, LayerKind.LOCATIONS_HIGHLIGHTED), highlightedLocationCircles, true));\n        }\n        if (showLocationAreas && isFeatureCollection(locations)) {\n            layers.push(this.getLocationAreasLayer(getLayerId(this.props.id, LayerKind.LOCATION_AREAS_OUTLINES), true));\n        }\n        return layers;\n    };\n    FlowMapLayer.prototype.getLocationAreasLayer = function (id, outline) {\n        var _a = this.props, locations = _a.locations, selectedLocationIds = _a.selectedLocationIds, highlightedLocationId = _a.highlightedLocationId, highlightedFlow = _a.highlightedFlow, updateTriggers = _a.updateTriggers;\n        var selectors = this.state.selectors;\n        var colors = selectors.getColors(this.props);\n        return new GeoJsonLayer(this.getSubLayerProps(__assign(__assign({ id: id, getFillColor: selectors.getLocationAreaFillColorGetter(this.props), getLineColor: colors.locationAreas.outline, lineJointRounded: true, data: locations, stroked: outline, filled: !outline }, (outline && { pickable: false })), { lineWidthMinPixels: 1, pointRadiusMinPixels: 1, updateTriggers: {\n                getFillColor: __assign(__assign({ colors: colors }, (outline && { selectedLocationIds: selectedLocationIds, highlightedLocationId: highlightedLocationId, highlightedFlow: highlightedFlow })), updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getLocationAreasFillColor),\n                getLineColor: __assign({ colors: colors }, updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getLocationAreasLineColor),\n            } })));\n    };\n    FlowMapLayer.prototype.getHighlightedLocationAreasLayer = function (id) {\n        var selectors = this.state.selectors;\n        var _a = this.props, highlightedLocationId = _a.highlightedLocationId, highlightedLocationAreaId = _a.highlightedLocationAreaId, updateTriggers = _a.updateTriggers;\n        var colors = selectors.getColors(this.props);\n        var getLocationById = selectors.getLocationByIdGetter(this.props);\n        return new GeoJsonLayer(this.getSubLayerProps({\n            id: id,\n            getFillColor: function () { return colors.locationAreas.highlighted; },\n            getLineColor: colors.locationAreas.outline,\n            lineJointRounded: true,\n            data: highlightedLocationId\n                ? getLocationById(highlightedLocationId)\n                : highlightedLocationAreaId\n                    ? getLocationById(highlightedLocationAreaId)\n                    : undefined,\n            stroked: false,\n            filled: true,\n            pickable: false,\n            lineWidthMinPixels: 5,\n            updateTriggers: {\n                getFillColor: __assign({ colors: colors }, updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getLocationAreasFillColor),\n                getLineColor: __assign({ colors: colors }, updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getLocationAreasLineColor),\n            },\n        }));\n    };\n    FlowMapLayer.prototype.getFlowLinesLayer = function (id, flows, highlighted, dimmed) {\n        var _a = this.props, getFlowOriginId = _a.getFlowOriginId, getFlowDestId = _a.getFlowDestId, getFlowMagnitude = _a.getFlowMagnitude, getLocationCentroid = _a.getLocationCentroid, getAnimatedFlowLineStaggering = _a.getAnimatedFlowLineStaggering, showTotals = _a.showTotals, maxLocationCircleSize = _a.maxLocationCircleSize, outlineThickness = _a.outlineThickness, minPickableFlowThickness = _a.minPickableFlowThickness, maxFlowThickness = _a.maxFlowThickness, updateTriggers = _a.updateTriggers;\n        var selectors = this.state.selectors;\n        var endpointOffsets = [(maxLocationCircleSize || 0) + 1, (maxLocationCircleSize || 0) + 1];\n        var getLocationRadius = selectors.getLocationCircleRadiusGetter(this.props);\n        var getLocationById = selectors.getLocationByIdGetter(this.props);\n        var flowThicknessScale = selectors.getFlowThicknessScale(this.props);\n        var getSourcePosition = function (flow, info) {\n            return getLocationCentroid(getLocationById(getFlowOriginId(flow, info)));\n        };\n        var getTargetPosition = function (flow, info) {\n            return getLocationCentroid(getLocationById(getFlowDestId(flow, info)));\n        };\n        var getThickness = function (flow, info) { return flowThicknessScale(getFlowMagnitude(flow, info)); };\n        var getEndpointOffsets = function (flow, info) {\n            if (!showTotals) {\n                return endpointOffsets;\n            }\n            return [\n                getLocationRadius({\n                    location: getLocationById(getFlowOriginId(flow, info)),\n                    type: \"outline\" /* OUTLINE */,\n                }),\n                getLocationRadius({\n                    location: getLocationById(getFlowDestId(flow, info)),\n                    type: \"outline\" /* OUTLINE */,\n                }),\n            ];\n        };\n        var flowColorScale = selectors.getFlowColorScale(this.props);\n        var colors = selectors.getColors(this.props);\n        var getColor = selectors.getFlowLinesColorGetter(colors, flowColorScale, highlighted, dimmed);\n        var animate = this.props.animate;\n        var thicknessUnit = maxFlowThickness != null ? maxFlowThickness : FlowLinesLayer.defaultProps.thicknessUnit;\n        var baseProps = __assign(__assign(__assign(__assign(__assign({ id: id,\n            getSourcePosition: getSourcePosition,\n            getTargetPosition: getTargetPosition,\n            getThickness: getThickness,\n            getEndpointOffsets: getEndpointOffsets,\n            getColor: getColor, data: flows }, (highlighted && { pickable: false })), { drawOutline: !dimmed, updateTriggers: {\n                getSourcePosition: updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getFlowLinesSourcePosition,\n                getTargetPosition: updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getFlowLinesTargetPosition,\n                getThickness: __assign({ maxFlowThickness: maxFlowThickness }, updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getFlowLinesThickness),\n                getColor: __assign({ colors: colors,\n                    dimmed: dimmed }, updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getFlowLinesColor),\n                getEndpointOffsets: __assign({ showTotals: showTotals }, updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getFlowLinesEndpointOffsets),\n            }, thicknessUnit: thicknessUnit, outlineColor: colors.outlineColor }), (outlineThickness && { outlineThickness: outlineThickness })), (minPickableFlowThickness != null && {\n            getPickable: function (f) { return (thicknessUnit * getThickness(f) >= minPickableFlowThickness ? 1.0 : 0.0); },\n        })), { parameters: __assign(__assign({}, this.props.parameters), { depthTest: false }) });\n        if (animate) {\n            return new AnimatedFlowLinesLayer(this.getSubLayerProps(__assign(__assign(__assign({}, baseProps), { currentTime: this.props.animationCurrentTime, tailLength: this.props.tailLength }), (getAnimatedFlowLineStaggering && {\n                getStaggering: getAnimatedFlowLineStaggering,\n            }))));\n        }\n        else {\n            return new FlowLinesLayer(this.getSubLayerProps(baseProps));\n        }\n    };\n    FlowMapLayer.prototype.getLocationCirclesLayer = function (id, circles, highlighted) {\n        var _a = this.props, highlightedLocationId = _a.highlightedLocationId, selectedLocationIds = _a.selectedLocationIds, getLocationCentroid = _a.getLocationCentroid, flows = _a.flows, showTotals = _a.showTotals, updateTriggers = _a.updateTriggers, maxLocationCircleSize = _a.maxLocationCircleSize;\n        var selectors = this.state.selectors;\n        var getRadius = showTotals ? selectors.getLocationCircleRadiusGetter(this.props) : function () { return maxLocationCircleSize; };\n        var colors = selectors.getColors(this.props);\n        var getColor = selectors.getLocationCircleColorGetter(this.props);\n        var getPosition = function (locCircle) { return getLocationCentroid(locCircle.location); };\n        return new FlowCirclesLayer(this.getSubLayerProps({\n            id: id,\n            getColor: getColor,\n            getPosition: getPosition,\n            getRadius: getRadius,\n            data: circles,\n            updateTriggers: {\n                getRadius: __assign({ showTotals: showTotals,\n                    selectedLocationIds: selectedLocationIds,\n                    maxLocationCircleSize: maxLocationCircleSize,\n                    flows: flows }, updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getCirclesRadius),\n                getColor: __assign({ colors: colors,\n                    highlightedLocationId: highlightedLocationId,\n                    selectedLocationIds: selectedLocationIds,\n                    flows: flows }, updateTriggers === null || updateTriggers === void 0 ? void 0 : updateTriggers.getCirclesColor),\n            },\n            parameters: __assign(__assign({}, this.props.parameters), { depthTest: false }),\n        }));\n    };\n    FlowMapLayer.layerName = 'FlowMapLayer';\n    FlowMapLayer.defaultProps = {\n        getLocationId: { type: 'accessor', value: function (l) { return l.id || l.properties.id; } },\n        getLocationCentroid: { type: 'accessor', value: function (l) { return l.properties.centroid; } },\n        getFlowOriginId: { type: 'accessor', value: function (f) { return f.origin; } },\n        getFlowDestId: { type: 'accessor', value: function (f) { return f.dest; } },\n        getFlowMagnitude: { type: 'accessor', value: function (f) { return f.count; } },\n        showTotals: true,\n        maxLocationCircleSize: 15,\n        outlineThickness: 1,\n        showLocationAreas: true,\n        tailLength: .7\n    };\n    return FlowMapLayer;\n}(CompositeLayer));\nexport default FlowMapLayer;\n//# sourceMappingURL=FlowMapLayer.js.map","/*\n * Copyright 2019 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nexport { default as LocationTotalsLegend } from './legend/LocationTotalsLegend';\nexport { default as DiffColorsLegend } from './legend/DiffColorsLegend';\nexport { default as LegendBox } from './legend/LegendBox';\nexport * from './viewport';\nexport * from './FlowMap';\nimport FlowMap from './FlowMap';\nexport default FlowMap;\n//# sourceMappingURL=index.js.map","/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport { rgbaAsString } from '@flowmap.gl/core';\nimport * as React from 'react';\nvar Disc = function (_a) {\n    var size = _a.size, inner = _a.inner, outer = _a.outer, outline = _a.outline;\n    return (React.createElement(\"svg\", { width: size, height: size, style: { marginRight: 5 } },\n        React.createElement(\"circle\", { cx: size / 2, cy: size / 2, r: size * 0.5, fill: rgbaAsString(outline) }),\n        React.createElement(\"circle\", { cx: size / 2, cy: size / 2, r: size * 0.5 - 1, fill: rgbaAsString(outer) }),\n        React.createElement(\"circle\", { cx: size / 2, cy: size / 2, r: size * 0.5 * 0.6 - 1, fill: rgbaAsString(inner) })));\n};\nexport default Disc;\n//# sourceMappingURL=Disc.js.map","/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nimport { getColorsRGBA, getDiffColorsRGBA, isDiffColorsRGBA } from '@flowmap.gl/core';\nimport * as React from 'react';\nimport Disc from './Disc';\nvar styles = {\n    outer: {\n        display: 'flex',\n        flexDirection: 'column',\n    },\n    item: {\n        outer: {\n            display: 'flex',\n            flexDirection: 'row',\n            padding: '3px 0',\n            alignItems: 'center',\n        },\n        caption: {\n            marginLeft: 2,\n        },\n    },\n};\nvar LocationTotalsLegend = function (_a) {\n    var diff = _a.diff, colors = _a.colors, aboutEqualText = _a.aboutEqualText, moreOutgoingText = _a.moreOutgoingText, moreIncomingText = _a.moreIncomingText;\n    var size = 20;\n    var colorsRGBA = diff ? getDiffColorsRGBA(colors) : getColorsRGBA(colors);\n    var pos = isDiffColorsRGBA(colorsRGBA) ? colorsRGBA.positive.locationCircles : colorsRGBA.locationCircles;\n    var neg = isDiffColorsRGBA(colorsRGBA) ? colorsRGBA.negative.locationCircles : undefined;\n    return (React.createElement(\"div\", { style: styles.outer },\n        React.createElement(\"div\", null,\n            React.createElement(\"div\", { style: styles.item.outer },\n                React.createElement(Disc, { size: size, inner: pos.inner, outer: pos.inner, outline: pos.inner }),\n                neg && React.createElement(Disc, { size: size, inner: neg.inner, outer: neg.inner, outline: neg.inner }),\n                React.createElement(\"div\", { style: styles.item.caption }, aboutEqualText || 'outgoing  incoming')),\n            React.createElement(\"div\", { style: styles.item.outer },\n                React.createElement(Disc, { size: size, inner: pos.inner, outer: pos.outgoing, outline: pos.inner }),\n                neg && React.createElement(Disc, { size: size, inner: neg.inner, outer: neg.outgoing, outline: neg.inner }),\n                React.createElement(\"div\", { style: styles.item.caption }, moreOutgoingText || 'more outgoing')),\n            React.createElement(\"div\", { style: styles.item.outer },\n                React.createElement(Disc, { size: size, inner: pos.inner, outer: pos.incoming, outline: pos.incoming }),\n                neg && React.createElement(Disc, { size: size, inner: neg.inner, outer: neg.incoming, outline: neg.incoming }),\n                React.createElement(\"div\", { style: styles.item.caption }, moreIncomingText || 'more incoming')))));\n};\nexport default LocationTotalsLegend;\n//# sourceMappingURL=LocationTotalsLegend.js.map","/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport React from 'react';\nvar styles = {\n    outer: {\n        position: 'absolute',\n        background: '#fff',\n        padding: 10,\n        borderRadius: 4,\n        border: '1px solid #ccc',\n    },\n};\nvar LegendBox = function (_a) {\n    var style = _a.style, top = _a.top, left = _a.left, right = _a.right, bottom = _a.bottom, children = _a.children;\n    return (React.createElement(\"div\", { style: __assign(__assign(__assign({}, styles.outer), style), { top: top,\n            left: left,\n            right: right,\n            bottom: bottom }) }, children));\n};\nexport default LegendBox;\n//# sourceMappingURL=LegendBox.js.map","/*\n * Copyright 2018 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nimport { DeckGL } from '@deck.gl/react';\nimport FlowMapLayer, { PickingType } from '@flowmap.gl/core';\nimport * as React from 'react';\nimport { StaticMap } from 'react-map-gl';\nvar FLOW_MAP_LAYER_ID = 'flow-map-layer';\nvar ESC_KEY = 'Escape';\nvar FlowMap = /** @class */ (function (_super) {\n    __extends(FlowMap, _super);\n    function FlowMap() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.state = {\n            viewState: _this.props.initialViewState,\n            time: 0,\n        };\n        _this.animationFrame = -1;\n        _this.animate = function () {\n            var loopLength = 1800; // unit corresponds to the timestamp in source data\n            var animationSpeed = 30; // unit time per second\n            var timestamp = Date.now() / 1000;\n            var loopTime = loopLength / animationSpeed;\n            _this.setState({\n                time: ((timestamp % loopTime) / loopTime) * loopLength,\n            });\n            _this.animationFrame = window.requestAnimationFrame(_this.animate);\n        };\n        _this.handleFlowMapHover = function (info) {\n            var type = info.type, object = info.object;\n            switch (type) {\n                case PickingType.FLOW: {\n                    if (!object) {\n                        _this.highlight(undefined);\n                    }\n                    else {\n                        _this.highlight({\n                            type: \"flow\" /* FLOW */,\n                            flow: object,\n                        }, info);\n                    }\n                    break;\n                }\n                case PickingType.LOCATION_AREA:\n                case PickingType.LOCATION: {\n                    var getLocationId = _this.props.getLocationId;\n                    if (!object) {\n                        _this.highlight(undefined);\n                    }\n                    else {\n                        _this.highlight({\n                            type: type === PickingType.LOCATION_AREA ? \"locationArea\" /* LOCATION_AREA */ : \"location\" /* LOCATION */,\n                            locationId: (getLocationId || FlowMapLayer.defaultProps.getLocationId.value)(object),\n                        }, info);\n                    }\n                    break;\n                }\n            }\n        };\n        _this.handleFlowMapClick = function (_a) {\n            var type = _a.type, object = _a.object;\n            switch (type) {\n                case PickingType.LOCATION_AREA:\n                case PickingType.LOCATION: {\n                    if (object) {\n                        var _b = _this.props, getLocationId = _b.getLocationId, multiselect = _b.multiselect;\n                        var selectedLocationIds = _this.state.selectedLocationIds;\n                        var locationId_1 = (getLocationId || FlowMapLayer.defaultProps.getLocationId.value)(object);\n                        var isSelected = selectedLocationIds && selectedLocationIds.indexOf(locationId_1) >= 0;\n                        var next = void 0;\n                        if (multiselect) {\n                            if (selectedLocationIds) {\n                                if (isSelected) {\n                                    next = selectedLocationIds.filter(function (id) { return id !== locationId_1; });\n                                }\n                                else {\n                                    next = __spreadArrays(selectedLocationIds, [locationId_1]);\n                                }\n                            }\n                            else {\n                                next = [locationId_1];\n                            }\n                        }\n                        else {\n                            if (isSelected) {\n                                next = undefined;\n                            }\n                            else {\n                                next = [locationId_1];\n                            }\n                        }\n                        _this.selectLocations(next);\n                        _this.highlight(undefined);\n                    }\n                    break;\n                }\n            }\n        };\n        _this.handleViewStateChange = function (_a) {\n            var viewState = _a.viewState;\n            _this.setState({\n                viewState: viewState,\n                highlight: undefined,\n            });\n            var onViewStateChange = _this.props.onViewStateChange;\n            if (onViewStateChange) {\n                onViewStateChange(viewState);\n            }\n        };\n        _this.handleKeyDown = function (evt) {\n            if (evt instanceof KeyboardEvent && evt.key === ESC_KEY) {\n                _this.setState({\n                    selectedLocationIds: undefined,\n                    highlight: undefined,\n                });\n            }\n        };\n        return _this;\n    }\n    FlowMap.getDerivedStateFromProps = function (props, state) {\n        if (props.selectedLocationIds !== state.selectedLocationIds) {\n            return {\n                selectedLocationIds: props.selectedLocationIds,\n            };\n        }\n        return null;\n    };\n    FlowMap.prototype.componentDidMount = function () {\n        document.addEventListener('keydown', this.handleKeyDown);\n        var animate = this.props.animate;\n        if (animate) {\n            this.animate();\n        }\n        var onViewStateChange = this.props.onViewStateChange;\n        if (onViewStateChange) {\n            var viewState = this.state.viewState;\n            if (viewState) {\n                onViewStateChange(viewState);\n            }\n        }\n    };\n    FlowMap.prototype.componentDidUpdate = function (prevProps, prevState, snapshot) {\n        var animate = this.props.animate;\n        if (animate !== prevProps.animate) {\n            if (animate) {\n                this.animate();\n            }\n            else {\n                this.stopAnimation();\n            }\n        }\n    };\n    FlowMap.prototype.componentWillUnmount = function () {\n        document.removeEventListener('keydown', this.handleKeyDown);\n        this.stopAnimation();\n    };\n    FlowMap.prototype.render = function () {\n        var _a = this.props, mapboxAccessToken = _a.mapboxAccessToken, mapStyle = _a.mapStyle, mixBlendMode = _a.mixBlendMode;\n        var flowMapLayer = this.getFlowMapLayer();\n        return (React.createElement(React.Fragment, null,\n            React.createElement(DeckGL, { style: { mixBlendMode: mixBlendMode }, layers: [flowMapLayer], viewState: this.state.viewState, controller: true, onViewStateChange: this.handleViewStateChange },\n                React.createElement(StaticMap, { width: \"100%\", height: \"100%\", mapboxApiAccessToken: mapboxAccessToken, mapStyle: mapStyle }))));\n    };\n    FlowMap.prototype.stopAnimation = function () {\n        if (this.animationFrame) {\n            window.cancelAnimationFrame(this.animationFrame);\n        }\n    };\n    FlowMap.prototype.getFlowMapLayer = function () {\n        var _a = this.props, initialViewState = _a.initialViewState, mapboxAccessToken = _a.mapboxAccessToken, mixBlendMode = _a.mixBlendMode, multiselect = _a.multiselect, tailLength = _a.tailLength, onSelected = _a.onSelected, onHighlighted = _a.onHighlighted, flowMapLayerProps = __rest(_a, [\"initialViewState\", \"mapboxAccessToken\", \"mixBlendMode\", \"multiselect\", \"tailLength\", \"onSelected\", \"onHighlighted\"]);\n        var _b = this.state, highlight = _b.highlight, selectedLocationIds = _b.selectedLocationIds;\n        return new FlowMapLayer(__assign(__assign({ id: FLOW_MAP_LAYER_ID, animationCurrentTime: this.state.time }, flowMapLayerProps), { selectedLocationIds: selectedLocationIds, tailLength: tailLength || .7, highlightedLocationId: highlight && highlight.type === \"location\" /* LOCATION */ ? highlight.locationId : undefined, highlightedLocationAreaId: highlight && highlight.type === \"locationArea\" /* LOCATION_AREA */ ? highlight.locationId : undefined, highlightedFlow: highlight && highlight.type === \"flow\" /* FLOW */ ? highlight.flow : undefined, onHover: this.handleFlowMapHover, onClick: this.handleFlowMapClick }));\n    };\n    FlowMap.prototype.highlight = function (highlight, info) {\n        this.setState({ highlight: highlight });\n        var onHighlighted = this.props.onHighlighted;\n        if (onHighlighted) {\n            onHighlighted(highlight, info);\n        }\n    };\n    FlowMap.prototype.selectLocations = function (selectedLocationIds) {\n        this.setState(function (state) { return (__assign(__assign({}, state), { selectedLocationIds: selectedLocationIds })); });\n        var onSelected = this.props.onSelected;\n        if (onSelected) {\n            onSelected(selectedLocationIds);\n        }\n    };\n    FlowMap.defaultProps = {\n        mixBlendMode: 'multiply',\n    };\n    return FlowMap;\n}(React.Component));\nexport default FlowMap;\n//# sourceMappingURL=FlowMap.js.map","/*\n * Copyright 2019 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport { Flow, FlowAccessors, FlowLayerPickingInfo, Location, LocationAccessors } from '@flowmap.gl/core';\nimport FlowMap, { Highlight, LegendBox, LocationTotalsLegend } from '@flowmap.gl/react';\nimport React from 'react';\nimport { ViewState } from '@flowmap.gl/core';\nimport * as d3scaleChromatic from 'd3-scale-chromatic';\n\nexport const mapboxAccessToken = process.env.REACT_APP_MapboxAccessToken;\n\nexport interface Props extends FlowAccessors, LocationAccessors {\n  locations: Location[];\n  flows: Flow[];\n  onViewStateChange?: (viewState: ViewState) => void;\n}\n\ninterface State {\n  tooltip: FlowLayerPickingInfo | undefined;\n}\n\nconst tooltipStyle: React.CSSProperties = {\n  position: 'absolute',\n  pointerEvents: 'none',\n  zIndex: 1,\n  background: '#125',\n  color: '#fff',\n  fontSize: 9,\n  borderRadius: 4,\n  padding: 5,\n  maxWidth: 300,\n  maxHeight: 300,\n  overflow: 'hidden',\n  boxShadow: '2px 2px 4px #ccc',\n};\n\nconst DARK_COLORS = {\n  flows: {\n    scheme: (d3scaleChromatic.schemeSpectral[d3scaleChromatic.schemeSpectral.length - 1] as string[]).slice().reverse(),\n    highlighted: \"white\"\n  },\n  dimmedOpacity: 0\n};\n\nexport default class Example extends React.Component<Props, State> {\n  state: State = {\n    tooltip: undefined,\n  };\n  private readonly initialViewState: ViewState;\n\n  constructor(props: Props) {\n    super(props);\n    this.initialViewState = {\n      latitude: -41.235726,\n      longitude: 172.5118422,\n      zoom: 5,\n      bearing: 0,\n      pitch: 0\n    };\n  }\n\n  handleViewStateChange = (viewState: ViewState) => {\n    const { onViewStateChange } = this.props;\n    if (onViewStateChange) {\n      onViewStateChange(viewState);\n    }\n    const { tooltip } = this.state;\n    if (tooltip) {\n      this.setState({ tooltip: undefined });\n    }\n  };\n\n  handleHighlight = (highlight: Highlight | undefined, info: FlowLayerPickingInfo | undefined) => {\n    if (!info) {\n      this.setState({ tooltip: undefined });\n    }\n    console.log(highlight, info, this.props)\n    this.setState({\n      //tooltip: info,\n    });\n  };\n\n  renderTooltip() {\n    const { tooltip } = this.state;\n    if (!tooltip) {\n      return null;\n    }\n    const { object, x, y } = tooltip;\n    if (!object) {\n      return null;\n    }\n    return (\n      <pre\n        style={{\n          ...tooltipStyle,\n          left: x,\n          top: y,\n        }}\n      >\n        {JSON.stringify(object, null, 2)}\n      </pre>\n    );\n  }\n\n  render() {\n    const { flows, locations, getLocationId, getLocationCentroid, getFlowMagnitude } = this.props;\n    return (\n      <>\n        <FlowMap\n          pickable={true}\n          initialViewState={this.initialViewState}\n          showTotals={true}\n          //showLocationAreas={false}\n          colors={DARK_COLORS}\n          flows={flows}\n          locations={locations}\n          mapStyle=\"mapbox://styles/mapbox/dark-v10\"\n          animate={true}\n          opacity={1}\n          mixBlendMode=\"screen\"\n          mapboxAccessToken={mapboxAccessToken}\n          getLocationId={getLocationId}\n          getLocationCentroid={getLocationCentroid}\n          getFlowMagnitude={getFlowMagnitude}\n          onViewStateChange={this.handleViewStateChange}\n          onHighlighted={this.handleHighlight}\n        />\n        <LegendBox bottom={35} right={10}>\n          <LocationTotalsLegend colors={DARK_COLORS} />\n          <div className=\"source\">Source: <a href=\"https://datafinder.stats.govt.nz/table/104720-2018-census-main-means-of-travel-to-work-by-statistical-area-2/data/\">Stats NZ</a></div>\n        </LegendBox>\n        {this.renderTooltip()}\n      </>\n    );\n  }\n}\n","/*\n * Copyright 2019 Teralytics\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n */\n\nimport * as Cluster from '@flowmap.gl/cluster';\nimport { Flow, FlowAccessors, Location, LocationAccessors } from '@flowmap.gl/core';\nimport { LegendBox } from '@flowmap.gl/react';\nimport React from 'react';\nimport { ViewState } from '@flowmap.gl/core';\nimport Example from './Example';\n\nexport interface Props extends FlowAccessors, LocationAccessors {\n  flows: Flow[];\n  locations: Location[];\n  clusterLevels?: Cluster.ClusterLevel[];\n}\n\ninterface State {\n  clusteredLocations: Location[] | undefined;\n  aggregateFlows: Flow[] | undefined;\n  flip?: boolean\n}\n\nclass ClusteringExample extends React.Component<Props, State> {\n  private readonly clusterIndex: Cluster.ClusterIndex;\n  private readonly aggregateFlowsByZoom: Map<number, Flow[]>;\n\n  constructor(props: Props) {\n    super(props);\n    const { flows, getLocationId, getLocationCentroid, getFlowOriginId, getFlowDestId, getFlowMagnitude } = this.props;\n    let clusterLevels;\n    const locations = this.props.locations;\n    if (this.props.clusterLevels) {\n      clusterLevels = this.props.clusterLevels;\n    } else {\n      const getLocationWeight = Cluster.makeLocationWeightGetter(flows, {\n        getFlowOriginId,\n        getFlowDestId,\n        getFlowMagnitude,\n      });\n      clusterLevels = Cluster.clusterLocations(locations, { getLocationId, getLocationCentroid }, getLocationWeight, {\n        makeClusterName: (id: number, numPoints: number) => `Cluster #${id} of ${numPoints} locations`,\n      });\n    }\n    const clusterIndex = Cluster.buildIndex(clusterLevels);\n    const aggregateFlowsByZoom = new Map<number, Flow[]>();\n    for (const zoom of clusterIndex.availableZoomLevels) {\n      aggregateFlowsByZoom.set(\n        zoom,\n        clusterIndex.aggregateFlows(flows, zoom, { getFlowOriginId, getFlowDestId, getFlowMagnitude }),\n      );\n    }\n    const maxZoom = Math.max.apply(null, clusterIndex.availableZoomLevels);\n    this.clusterIndex = clusterIndex;\n    this.aggregateFlowsByZoom = aggregateFlowsByZoom;\n    this.state = {\n      clusteredLocations: this.clusterIndex.getClusterNodesFor(maxZoom),\n      aggregateFlows: this.aggregateFlowsByZoom.get(maxZoom),\n    };\n  }\n\n  handleViewStateChange = (viewState: ViewState) => {\n    const { availableZoomLevels } = this.clusterIndex;\n    const { zoom } = viewState;\n    var clusterZoom = Cluster.findAppropriateZoomLevel(availableZoomLevels, zoom);\n    if (clusterZoom > 12) clusterZoom = 12;\n    this.setState({\n      clusteredLocations: this.clusterIndex.getClusterNodesFor(clusterZoom),\n      aggregateFlows: this.aggregateFlowsByZoom.get(clusterZoom),\n    });\n  };\n\n  render() {\n    const { getFlowOriginId, getFlowDestId, getFlowMagnitude } = this.props;\n    const { clusteredLocations, aggregateFlows } = this.state;\n    if (!clusteredLocations || !aggregateFlows) {\n      return null;\n    }\n    var flippedFlows = [];\n    for (var f of aggregateFlows) {\n      if (f.aggregate) {\n        flippedFlows.push({aggregate: true, origin: f.dest, dest: f.origin, count: f.count});\n      } else {\n        flippedFlows.push({home_SA2: f.work_SA2, work_SA2: f.home_SA2, Total: f.Total});\n      }\n    }\n    return (\n      <>\n      <Example\n        locations={clusteredLocations}\n        flows={this.state.flip ? flippedFlows : aggregateFlows}\n        getLocationId={(loc: Cluster.ClusterNode) => loc.id}\n        getLocationCentroid={(loc: Cluster.ClusterNode) => loc.centroid}\n        getFlowOriginId={(flow: Flow) => Cluster.isAggregateFlow(flow) ? flow.origin : getFlowDestId(flow)}\n        getFlowDestId={(flow: Flow) =>Cluster.isAggregateFlow(flow) ? flow.dest : getFlowOriginId(flow)}\n        getFlowMagnitude={(flow: Flow) => (Cluster.isAggregateFlow(flow) ? flow.count : getFlowMagnitude(flow))}\n        onViewStateChange={this.handleViewStateChange}\n      />\n      \n      <LegendBox bottom={200} right={10}>\n          Reverse flow: <input\n              type=\"checkbox\"\n              checked={!!this.state.flip}\n              onChange={evt => {\n                this.setState({flip: evt.target.checked})\n              }}\n          />\n      </LegendBox>\n      </>\n    );\n  }\n}\n\nexport default ClusteringExample;\n","import React, {Component} from 'react'\nimport Papa from \"papaparse\"\nimport ClusteringExample from \"./ClusteringExample\";\n\nimport './App.css'\n\nPapa.parsePromise = function(file) {\n  return new Promise(function(complete, error) {\n    Papa.parse(file, {\n      download: true,\n      header: true,\n      dynamicTyping: true,\n      skipEmptyLines: true,\n      complete,\n      error\n    });\n  });\n};\n\nexport default class App extends Component {\n  state = {\n    locations: null,\n    flows: null,\n    time: 0\n  }\n\n  componentDidMount() {\n    \n    Promise.all([\n      Papa.parsePromise(\"https://neon-ninja.github.io/TABA/travel.csv\"),\n      Papa.parsePromise(\"https://neon-ninja.github.io/TABA/sa2_centroids.csv\")\n    ]).then(([travel, sa2_centroids]) => {\n      console.log(travel, sa2_centroids, this.state)\n      this.setState({\n        flows: travel.data,\n        locations: sa2_centroids.data\n      })\n    })\n  }\n\n  render() {\n    const { locations, flows } = this.state\n    if (locations && flows) {\n      return (\n        <ClusteringExample\n          locations={locations}\n          flows={flows}\n          getLocationId={(loc) => loc.code}\n          getLocationCentroid={(loc) => [loc.longitude, loc.latitude]}\n          getFlowOriginId={(flow) => flow.home_SA2}\n          getFlowDestId={(flow) => flow.work_SA2}\n          getFlowMagnitude={(flow) => flow.Total}\n        />\n      )\n    }\n    return null\n\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\ndocument.write(\n  `<h1 id=\"title\">There and back again - a visualisation of the 2018 NZ census commuter data</h1>\n   <a href=\"https://github.com/neon-ninja/TABA\">\n    <img \n      style=\"position: absolute; top: 0; right: 0; border: 0;\" \n      src=\"https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png\" \n      alt=\"Fork me on GitHub\">\n   </a>\n `\n);\n"],"sourceRoot":""}